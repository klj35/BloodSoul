<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="着色语言, 血魂S">
    <meta name="description" content="万物皆可萌！">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>着色语言 | 血魂S</title>
    <link rel="icon" type="image/png" href="/BloodSoul.github.io/favicon.png">

    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/css/my.css">

    <script src="/BloodSoul.github.io/libs/jquery/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/klj35/live2d-widget@v0.9.1/autoload.js"></script>
    
<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/BloodSoul.github.io/atom.xml" title="血魂S" type="application/atom+xml">
</head>



   <style>
    body{
       background-image: url(https://raw.githubusercontent.com/klj35/BloodSoulBlockImage/main/img/wallhaven-837yey_2560x1440.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/BloodSoul.github.io/" class="waves-effect waves-light">
                    
                    <img src="/BloodSoul.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">血魂S</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/BloodSoul.github.io/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/BloodSoul.github.io/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/BloodSoul.github.io/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/BloodSoul.github.io/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/BloodSoul.github.io/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/BloodSoul.github.io/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/BloodSoul.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">血魂S</div>
        <div class="logo-desc">
            
            万物皆可萌！
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/BloodSoul.github.io/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/BloodSoul.github.io/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/BloodSoul.github.io/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/BloodSoul.github.io/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/BloodSoul.github.io/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/BloodSoul.github.io/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/BloodSoul.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/BloodSoul.github.io/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/BloodSoul.github.io/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">着色语言</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/BloodSoul.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/BloodSoul.github.io/tags/%E5%9B%BE%E5%BD%A2%E7%A1%AC%E4%BB%B6/">
                                <span class="chip bg-color">图形硬件</span>
                            </a>
                        
                            <a href="/BloodSoul.github.io/tags/GPU%E6%9E%B6%E6%9E%84/">
                                <span class="chip bg-color">GPU架构</span>
                            </a>
                        
                            <a href="/BloodSoul.github.io/tags/ShaderLanguage/">
                                <span class="chip bg-color">ShaderLanguage</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/BloodSoul.github.io/categories/Rendering/" class="post-category">
                                Rendering
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-12-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-12-31
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    14.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    59 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/BloodSoul.github.io/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="GLSL基础语法"><a href="#GLSL基础语法" class="headerlink" title="GLSL基础语法"></a>GLSL基础语法</h1><p>官网文档：</p>
<p><a target="_blank" rel="noopener" href="https://www.khronos.org/registry/OpenGL/specs/gl/GLSLangSpec.1.20.pdf">https://www.khronos.org/registry/OpenGL/specs/gl/GLSLangSpec.1.20.pdf</a></p>
<p>内置方法：</p>
<p><a target="_blank" rel="noopener" href="https://www.khronos.org/registry/OpenGL-Refpages/">https://www.khronos.org/registry/OpenGL-Refpages/</a></p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><blockquote>
<p>单行注释：//<br> 多行注释：/* */</p>
</blockquote>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>GLSL的变量命名方式与C语言类似。变量的名称可以使用字母，数字以及下划线，但变量名不能以数字开头，还有变量名不能以gl_作为前缀，这个是GLSL保留的前缀，用于GLSL的内部变量。当然还有一些GLSL保留的名称是不能够作为变量的名称的。</p>
<h4 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h4><p>除了布尔型，整型，浮点型基本类型外，GLSL还引入了一些在着色器中经常用到的类型作为基本类型。这些基本类型都可以作为结构体内部的类型。如下表:</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th align="right">描述</th>
</tr>
</thead>
<tbody><tr>
<td>void</td>
<td align="right">跟C语言的void类似，表示空类型。作为函数的返回类型，表示这个函数不返回值。</td>
</tr>
<tr>
<td>bool</td>
<td align="right">布尔类型，可以是true 和false，以及可以产生布尔型的表达式。</td>
</tr>
<tr>
<td>int</td>
<td align="right">整型 代表至少包含16位的有符号的整数。可以是十进制的，十六进制的，八进制的。</td>
</tr>
<tr>
<td>float</td>
<td align="right">浮点型</td>
</tr>
<tr>
<td>bvec2</td>
<td align="right">包含2个布尔成分的向量</td>
</tr>
<tr>
<td>bvec3</td>
<td align="right">包含3个布尔成分的向量</td>
</tr>
<tr>
<td>bvec4</td>
<td align="right">包含4个布尔成分的向量</td>
</tr>
<tr>
<td>ivec2</td>
<td align="right">包含2个整型成分的向量</td>
</tr>
<tr>
<td>ivec3</td>
<td align="right">包含3个整型成分的向量</td>
</tr>
<tr>
<td>ivec4</td>
<td align="right">包含4个整型成分的向量</td>
</tr>
<tr>
<td>mat2 或者 mat2x2</td>
<td align="right">2×2的浮点数矩阵类型</td>
</tr>
<tr>
<td>mat3或者mat3x3</td>
<td align="right">3×3的浮点数矩阵类型</td>
</tr>
<tr>
<td>mat4x4</td>
<td align="right">4×4的浮点矩阵</td>
</tr>
<tr>
<td>mat2x3</td>
<td align="right">2列3行的浮点矩阵（OpenGL的矩阵是列主顺序的）</td>
</tr>
<tr>
<td>mat2x4</td>
<td align="right">2列4行的浮点矩阵</td>
</tr>
<tr>
<td>mat3x2</td>
<td align="right">3列2行的浮点矩阵</td>
</tr>
<tr>
<td>mat3x4</td>
<td align="right">3列4行的浮点矩阵</td>
</tr>
<tr>
<td>mat4x2</td>
<td align="right">4列2行的浮点矩阵</td>
</tr>
<tr>
<td>mat4x3</td>
<td align="right">4列3行的浮点矩阵</td>
</tr>
<tr>
<td>sampler1D</td>
<td align="right">用于内建的纹理函数中引用指定的1D纹理的句柄。只可以作为一致变量或者函数参数使用</td>
</tr>
<tr>
<td>sampler2D</td>
<td align="right">二维纹理句柄</td>
</tr>
<tr>
<td>sampler3D</td>
<td align="right">三维纹理句柄</td>
</tr>
<tr>
<td>samplerCube</td>
<td align="right">cube map纹理句柄</td>
</tr>
<tr>
<td>sampler1DShadow</td>
<td align="right">一维深度纹理句柄</td>
</tr>
<tr>
<td>sampler2DShadow</td>
<td align="right">二维深度纹理句柄</td>
</tr>
</tbody></table>
<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><p>结构体可以组合基本类型和数组来形成用户自定义的类型。在定义一个结构体的同时，你可以定义一个结构体实例。或者后面再定义。</p>
<ul>
<li>=为结构体赋值，</li>
<li>==，!=来判断两个结构体是否相等。</li>
</ul>
<p>mySurface = secondSurface;</p>
<p>mySurface == secondSurface;</p>
<p>只有结构体中的每个成分都相等，那么这两个结构体才是相等的。访问结构体的内部成员使用. (点语法)来访问。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec3</span> color <span class="token operator">=</span> mySurface<span class="token punctuation">.</span>color <span class="token operator">+</span> secondSurface<span class="token punctuation">.</span>color<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结构体至少包含一个成员。固定大小的数组也可以被包含在结构体中。GLSL的结构体不支持嵌套定义。只有预先声明的结构体可以嵌套其中。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">struct</span> <span class="token class-name">myStruct</span> <span class="token punctuation">{</span>

  <span class="token keyword">vec3</span> points<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//固定大小的数组是合法的</span>

  surface surf<span class="token punctuation">;</span>  <span class="token comment">//可以，之前已经定义了</span>

  <span class="token keyword">struct</span> <span class="token class-name">velocity</span> <span class="token punctuation">{</span>  <span class="token comment">//不合法float speed;</span>

    <span class="token keyword">vec3</span> direction<span class="token punctuation">;</span>

  <span class="token punctuation">}</span> velo<span class="token punctuation">;</span>

  subSurface sub<span class="token punctuation">;</span> <span class="token comment">//不合法，没有预先声明；};</span>

  <span class="token keyword">struct</span> <span class="token class-name">subSurface</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> ID<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>GLSL中只可以使用一维的数组。数组的类型可以是一切基本类型或者结构体。下面的几种数组声明是合法的：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec4</span> lightPositions<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">vec4</span> lightPos<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> lightPositions<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> numSurfaces <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
surface myFiveSurfaces<span class="token punctuation">[</span>numSurfaces<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> values<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>指定显示大小的数组可以作为函数的参数或者使返回值,也可以作为结构体的成员.数组类型内建了一个length()函数，可以返回数组的长度。</p>
<p><code>lightPositions.length()</code> //返回数组的大小 8</p>
<p>最后，你不能定义数组的数组。</p>
<h4 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h4><p>变量的声明可以使用如下的修饰符。</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>const</td>
<td>常量值必须在声明是初始化。它是只读的不可修改的。</td>
</tr>
<tr>
<td>attribute</td>
<td>表示只读的顶点数据，只用在顶点着色器中。数据来自当前的顶点状态或者顶点数组。它必须是全局范围声明的，不能再函数内部。一个attribute可以是浮点数类型的标量，向量，或者矩阵。不可以是数组或则结构体</td>
</tr>
<tr>
<td>uniform</td>
<td>一致变量。在着色器执行期间一致变量的值是不变的。与const常量不同的是，这个值在编译时期是未知的是由着色器外部初始化的。一致变量在顶点着色器和片段着色器之间是共享的。它也只能在全局范围进行声明。</td>
</tr>
<tr>
<td>varying</td>
<td>顶点着色器的输出。例如颜色或者纹理坐标，（插值后的数据）作为片段着色器的只读输入数据。必须是全局范围声明的全局变量。可以是浮点数类型的标量，向量，矩阵。不能是数组或者结构体。</td>
</tr>
<tr>
<td>centorid varying</td>
<td>在没有多重采样的情况下，与varying是一样的意思。在多重采样时，centorid varying在光栅化的图形内部进行求值而不是在片段中心的固定位置求值。</td>
</tr>
<tr>
<td>invariant</td>
<td>(不变量)用于表示顶点着色器的输出和任何匹配片段着色器的输入，在不同的着色器中计算产生的值必须是一致的。所有的数据流和控制流，写入一个invariant变量的是一致的。编译器为了保证结果是完全一致的，需要放弃那些可能会导致不一致值的潜在的优化。除非必要，不要使用这个修饰符。在多通道渲染中避免z-fighting可能会使用到。</td>
</tr>
<tr>
<td>in</td>
<td>用在函数的参数中，表示这个参数是输入的，在函数中改变这个值，并不会影响对调用的函数产生副作用。（相当于C语言的传值），这个是函数参数默认的修饰符</td>
</tr>
<tr>
<td>out</td>
<td>用在函数的参数中，表示该参数是输出参数，值是会改变的。</td>
</tr>
<tr>
<td>inout</td>
<td>用在函数的参数，表示这个参数即是输入参数也是输出参数。</td>
</tr>
</tbody></table>
<h4 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h4><p>内置变量可以与固定函数功能进行交互。在使用前不需要声明。顶点着色器可用的内置变量如下表：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>gl_Color</td>
<td>vec4</td>
<td>输入属性-表示顶点的主颜色</td>
</tr>
<tr>
<td>gl_SecondaryColor</td>
<td>vec4</td>
<td>输入属性-表示顶点的辅助颜色</td>
</tr>
<tr>
<td>gl_Normal</td>
<td>vec3</td>
<td>输入属性-表示顶点的法线值</td>
</tr>
<tr>
<td>gl_Vertex</td>
<td>vec4</td>
<td>输入属性-表示物体空间的顶点位置</td>
</tr>
<tr>
<td>gl_MultiTexCoordn</td>
<td>vec4</td>
<td>输入属性-表示顶点的第n个纹理的坐标</td>
</tr>
<tr>
<td>gl_FogCoord</td>
<td>float</td>
<td>输入属性-表示顶点的雾坐标</td>
</tr>
<tr>
<td>gl_Position</td>
<td>vec4</td>
<td>输出属性-变换后的顶点的位置，用于后面的固定的裁剪等操作。所有的顶点着色器都必须写这个值。</td>
</tr>
<tr>
<td>gl_ClipVertex</td>
<td>vec4</td>
<td>输出坐标，用于用户裁剪平面的裁剪</td>
</tr>
<tr>
<td>gl_PointSize</td>
<td>float</td>
<td>点的大小</td>
</tr>
<tr>
<td>gl_FrontColor</td>
<td>vec4</td>
<td>正面的主颜色的varying输出</td>
</tr>
<tr>
<td>gl_BackColor</td>
<td>vec4</td>
<td>背面主颜色的varying输出</td>
</tr>
<tr>
<td>gl_FrontSecondaryColor</td>
<td>vec4</td>
<td>正面的辅助颜色的varying输出</td>
</tr>
<tr>
<td>gl_BackSecondaryColor</td>
<td>vec4</td>
<td>背面的辅助颜色的varying输出</td>
</tr>
<tr>
<td>gl_TexCoord[]</td>
<td>vec4</td>
<td>纹理坐标的数组varying输出</td>
</tr>
<tr>
<td>gl_FogFragCoord</td>
<td>float</td>
<td>雾坐标的varying输出</td>
</tr>
</tbody></table>
<p>片段着色器的内置变量如下表：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>gl_Color</td>
<td>vec4</td>
<td>包含主颜色的插值只读输入</td>
</tr>
<tr>
<td>gl_SecondaryColor</td>
<td>vec4</td>
<td>包含辅助颜色的插值只读输入</td>
</tr>
<tr>
<td>gl_TexCoord[]</td>
<td>vec4</td>
<td>包含纹理坐标数组的插值只读输入</td>
</tr>
<tr>
<td>gl_FogFragCoord</td>
<td>float</td>
<td>包含雾坐标的插值只读输入</td>
</tr>
<tr>
<td>gl_FragCoord</td>
<td>vec4</td>
<td>只读输入，窗口的x,y,z和1/w</td>
</tr>
<tr>
<td>gl_FrontFacing</td>
<td>bool</td>
<td>只读输入，如果是窗口正面图元的一部分，则这个值为true</td>
</tr>
<tr>
<td>gl_PointCoord</td>
<td>vec2</td>
<td>点精灵的二维空间坐标范围在(0.0, 0.0)到(1.0, 1.0)之间，仅用于点图元和点精灵开启的情况下。</td>
</tr>
<tr>
<td>gl_FragData[]</td>
<td>vec4</td>
<td>使用glDrawBuffers输出的数据数组。不能与gl_FragColor结合使用。</td>
</tr>
<tr>
<td>gl_FragColor</td>
<td>vec4</td>
<td>输出的颜色用于随后的像素操作</td>
</tr>
<tr>
<td>gl_FragDepth</td>
<td>float</td>
<td>输出的深度用于随后的像素操作，如果这个值没有被写，则使用固定功能管线的深度值代替</td>
</tr>
</tbody></table>
<h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h3><h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><p>GLSL语言的操作符与C语言相似。如下表（操作符的优先级从高到低排列）</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>()</td>
<td>用于表达式组合，函数调用，构造</td>
<td></td>
<td></td>
</tr>
<tr>
<td>[]</td>
<td>数组下标，向量或矩阵的选择器</td>
<td></td>
<td></td>
</tr>
<tr>
<td>.</td>
<td>结构体和向量的成员选择</td>
<td></td>
<td></td>
</tr>
<tr>
<td>++ –</td>
<td>前缀或后缀的自增自减操作符</td>
<td></td>
<td></td>
</tr>
<tr>
<td>+ – !</td>
<td>一元操作符，表示正 负 逻辑非</td>
<td></td>
<td></td>
</tr>
<tr>
<td>* /</td>
<td>乘 除操作符</td>
<td></td>
<td></td>
</tr>
<tr>
<td>+ -</td>
<td>二元操作符 表示加 减操作</td>
<td></td>
<td></td>
</tr>
<tr>
<td>&lt;&gt; &lt;= &gt;= == !=</td>
<td>小于，大于，小于等于， 大于等于，等于，不等于 判断符</td>
<td></td>
<td></td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td></td>
<td>^^</td>
<td>逻辑与 ，或，  异或</td>
</tr>
<tr>
<td>?:</td>
<td>条件判断符</td>
<td></td>
<td></td>
</tr>
<tr>
<td>= += –= *=  /=</td>
<td>赋值操作符</td>
<td></td>
<td></td>
</tr>
<tr>
<td>,</td>
<td>表示序列</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>像 求地址的&amp; 和 解引用的 * 操作符不再GLSL中出现，因为GLSL不能直接操作地址。类型转换操作也是不允许的。 位操作符(&amp;,|,^,~, &lt;&lt;, &gt;&gt; ,&amp;=, |=, ^=, &lt;&lt;=, &gt;&gt;=)是GLSL保留的操作符，将来可能会被使用。还有求模操作（%，%=)也是保留的。</p>
<h4 id="数组访问"><a href="#数组访问" class="headerlink" title="数组访问"></a>数组访问</h4><p>数组的下标从0开始。合理的范围是[0, size - 1]。跟C语言一样。如果数组访问越界了，那行为是未定义的。如果着色器的编译器在编译时知道数组访问越界了，就会提示编译失败。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec4</span> myColor<span class="token punctuation">,</span> ambient<span class="token punctuation">,</span> diffuse<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> specular<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

myColor <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> specular<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h4><p>构造函数可以用于初始化包含多个成员的变量，包括数组和结构体。构造函数也可以用在表达式中。调用方式如下：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec3</span> myNormal <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

greenTint <span class="token operator">=</span> myColor <span class="token operator">+</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ivec4</span> myColor <span class="token operator">=</span> <span class="token keyword">ivec4</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>还可以使用混合标量和向量的方式来构造，只要你的元素足以填满该向量。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec4</span> color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">vec3</span> v <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">vec3</span> v1 <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">vec2</span> fv <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">6.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>fv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用x值2.5构造，y值被舍弃</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对于矩阵，OpenGL中矩阵是列主顺序的。如果只传了一个值，则会构造成对角矩阵，其余的元素为0.</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">mat3</span> m3 <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>构造出来的矩阵：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token number">1.0</span> <span class="token number">0.0</span> <span class="token number">0.0</span>

<span class="token number">0.0</span> <span class="token number">1.0</span> <span class="token number">0.0</span>

<span class="token number">0.0</span> <span class="token number">0.0</span> <span class="token number">1.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">mat2</span> matrix1 <span class="token operator">=</span> <span class="token keyword">mat2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">mat2</span> matrix2 <span class="token operator">=</span> <span class="token keyword">mat2</span><span class="token punctuation">(</span><span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">mat2</span> matrix3 <span class="token operator">=</span> <span class="token keyword">mat2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">mat2</span> matrix4 <span class="token operator">=</span> <span class="token keyword">mat2</span><span class="token punctuation">(</span><span class="token keyword">mat4</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//会取 4×4矩阵左上角的2×2矩阵。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构造函数可以用于标量数据类型的转换。GLSL不支持隐式或显示的转换，只能通过构造函数来转。其中int转为float值是一样的。float转为int则小数部分被丢弃。int或float转为bool，0和0.0转为false，其余的值转为true. bool转为int或float，false值转为0和0.0，true转为1和1.0.</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1.7</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> I <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// I = 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>数组的初始化，可以在构造函数中传入值来初始化数组中对应的每一个值。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">ivec2</span> position<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">ivec2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ivec2</span> pos2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">ivec2</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>构造函数也可以对结构体进行初始化。其中顺序和类型要一一对应。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">struct</span> <span class="token class-name">surface</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span>  index<span class="token punctuation">;</span>
   <span class="token keyword">vec3</span> color<span class="token punctuation">;</span>  <span class="token keyword">float</span> rotate<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

surface mySurface <span class="token operator">=</span> <span class="token function">surface</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="成分选择"><a href="#成分选择" class="headerlink" title="成分选择"></a>成分选择</h4><p>向量中单独的成分可以通过{x,y,z,w},{r,g,b,a}或者{s,t,p,q}的记法来表示。这些不同的记法用于顶点，颜色，纹理坐标。在成分选择中，你不可以混合使用这些记法。其中{s,t,p,q}中的p替换了纹理的r坐标，因为与颜色r重复了。下面是用法举例：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec3</span> myVec <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.35</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> r <span class="token operator">=</span> myVec<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
<span class="token keyword">float</span> myYz <span class="token operator">=</span> myVec<span class="token punctuation">.</span>yz<span class="token punctuation">;</span>
<span class="token keyword">float</span> myQ <span class="token operator">=</span> myVec<span class="token punctuation">.</span>q<span class="token punctuation">;</span><span class="token comment">//出错，数组越界访问，q代表第四个元素</span>
<span class="token keyword">float</span> myRY <span class="token operator">=</span> myVec<span class="token punctuation">.</span>ry<span class="token punctuation">;</span> <span class="token comment">//不合法，混合使用记法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>较特殊的使用方式，你可以重复向量中的元素，或者颠倒其顺序。如：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"> <span class="token comment">//调换顺序</span>
<span class="token keyword">vec3</span> yxz <span class="token operator">=</span> myVec<span class="token punctuation">.</span>yxz<span class="token punctuation">;</span>

 <span class="token comment">//重复其中的值</span>
<span class="token keyword">vec4</span> mySSTT <span class="token operator">=</span> myVec<span class="token punctuation">.</span>sstt<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在赋值是，也可以选择你想要的顺序，但是不能重复其中的成分。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec4</span> myColor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
myColor<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">;</span>
myColor<span class="token punctuation">.</span>yz <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myColor<span class="token punctuation">.</span>wx <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myColor<span class="token punctuation">.</span>zz <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//不合法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们也可以通过使用下标来访问向量或矩阵中的元素。如果越界那行为将是未定义的。</p>
<p>float myY = myVec[1];</p>
<p>在矩阵中，可以通过一维的下标来获得该列的向量(OpenGL的矩阵是列主顺序的)。二维的小标来获得向量中的元素。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">mat3</span> myMat <span class="token operator">=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">vec3</span> myVec <span class="token operator">=</span> myMat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//获得第一列向量    1.0, 0.0, 0.0</span>
<span class="token keyword">float</span> f <span class="token operator">=</span> myMat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 第一列的第一个向量。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><h4 id="1-循环"><a href="#1-循环" class="headerlink" title="1.循环"></a>1.循环</h4><p>与C和C++相似，GLSL语言也提供了for, while, do/while的循环方式。使用continue跳入下一次循环，break结束循环。</p>
<pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token comment">//for循环</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> NUMCount<span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ary<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
    a<span class="token operator">+=</span> ary<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//while</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> num<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> ary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//do while</span>
<span class="token keyword">do</span><span class="token punctuation">{</span>
    color <span class="token operator">+=</span> light<span class="token punctuation">[</span>lightNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    lightNum<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">while</span> <span class="token punctuation">(</span>lightNum <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="if-else控制语句"><a href="#if-else控制语句" class="headerlink" title="if/else控制语句"></a>if/else控制语句</h4><pre class="line-numbers language-swift" data-language="swift"><code class="language-swift"><span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    a <span class="token operator">=</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    a<span class="token operator">=</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="discard"><a href="#discard" class="headerlink" title="discard"></a>discard</h4><p>片段着色器中有一种特殊的控制流成为discard。使用discard会退出片段着色器，不执行后面的片段着色操作。片段也不会写入帧缓冲区。</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css">if <span class="token punctuation">(</span>color.a &lt; 0.9<span class="token punctuation">)</span>

 discard<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>在每个shader中必须有一个main函数。main函数中的void参数是可选的，但返回值是void时必须的。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>GLSL中的函数，必须是在全局范围定义和声明的。不能在函数定义中声明或定义函数。函数必须有返回类型，参数是可选的。参数的修饰符(in, out, inout, const等）是可选的。</strong></p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token comment">//函数声明</span>
<span class="token keyword">bool</span> <span class="token function">isAnyNegative</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">vec4</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//函数调用void main(void)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">bool</span> isNegative <span class="token operator">=</span> <span class="token function">isAnyNegative</span><span class="token punctuation">(</span>gl_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//定义</span>
<span class="token keyword">bool</span> <span class="token function">isAnyNegative</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">vec4</span> v<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token operator">||</span> v<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token operator">||</span> v<span class="token punctuation">.</span>z <span class="token operator">&lt;</span> <span class="token number">0.0</span> <span class="token operator">||</span> v<span class="token punctuation">.</span>w <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>结构体和数组也可以作为函数的参数。如果是数组作为函数的参数，则必须制定其大小。在调用传参时，只传数组名就可以了。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">vec4</span> <span class="token function">sumVectors</span><span class="token punctuation">(</span><span class="token keyword">int</span> sumSize<span class="token punctuation">,</span> <span class="token keyword">vec4</span> v<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">vec4</span> myColors<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">vec4</span> sumColor <span class="token operator">=</span> <span class="token function">sumVectors</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> myColors<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">vec4</span> <span class="token function">sumVectors</span><span class="token punctuation">(</span><span class="token keyword">int</span> sumSize<span class="token punctuation">,</span> <span class="token keyword">vec4</span> v<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">vec4</span> sum <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sumSize<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>GLSL的函数是支持重载的。函数可以同名但其参数类型或者参数个数不同即可。</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">float</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">float</span> a<span class="token punctuation">,</span> <span class="token keyword">float</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">vec3</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">vec3</span> v1<span class="token punctuation">,</span> <span class="token keyword">vec3</span> v2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> v1 <span class="token operator">+</span> v2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><table>
<thead>
<tr>
<th>优先级(越小越高)</th>
<th>运算符</th>
<th>说明</th>
<th>结合性</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>()</td>
<td>聚组:a*(b+c)</td>
<td>N/A</td>
</tr>
<tr>
<td>2</td>
<td>[] () . ++ –</td>
<td>数组下标__[],方法参数__fun(arg1,arg2,arg3),属性访问<strong>a.b</strong>,自增/减后缀<strong>a++ a–</strong></td>
<td>L - R</td>
</tr>
<tr>
<td>3</td>
<td>++ – + - !</td>
<td>自增/减前缀**++a –a**,正负号(一般正号不写)a ,-a,取反**!false**</td>
<td>R - L</td>
</tr>
<tr>
<td>4</td>
<td>* /</td>
<td>乘除数学运算</td>
<td>L - R</td>
</tr>
<tr>
<td>5</td>
<td>+ -</td>
<td>加减数学运算</td>
<td>L - R</td>
</tr>
<tr>
<td>7</td>
<td>&lt; &gt; &lt;= &gt;=</td>
<td>关系运算符</td>
<td>L - R</td>
</tr>
<tr>
<td>8</td>
<td>== !=</td>
<td>相等性运算符</td>
<td>L - R</td>
</tr>
<tr>
<td>12</td>
<td>&amp;&amp;</td>
<td>逻辑与</td>
<td>L - R</td>
</tr>
<tr>
<td>13</td>
<td>^^</td>
<td>逻辑排他或(用处基本等于!=)</td>
<td>L - R</td>
</tr>
<tr>
<td>14</td>
<td>II</td>
<td>逻辑或</td>
<td>L - R</td>
</tr>
<tr>
<td>15</td>
<td><strong>? :</strong></td>
<td>三目运算符</td>
<td>L - R</td>
</tr>
<tr>
<td>16</td>
<td>= += -= *= /=</td>
<td>赋值与复合赋值</td>
<td>L - R</td>
</tr>
<tr>
<td>17</td>
<td>,</td>
<td>顺序分配运算</td>
<td>L - R</td>
</tr>
</tbody></table>
<p>ps 左值与右值:</p>
<pre class="line-numbers language-undefined" data-language="undefined"><code class="language-undefined">左值:表示一个储存位置,可以是变量,也可以是表达式,但表达式最后的结果必须是一个储存位置.

右值:表示一个值, 可以是一个变量或者表达式再或者纯粹的值.

操作符的优先级：决定含有多个操作符的表达式的求值顺序，每个操作的优先级不同.

操作符的结合性：决定相同优先级的操作符是从左到右计算，还是从右到左计算。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="基础类型间的运算"><a href="#基础类型间的运算" class="headerlink" title="基础类型间的运算:"></a>基础类型间的运算:</h3><p>glsl中,没有隐式类型转换,原则上glsl要求任何表达式左右两侧(l-value),(r-value)的类型必须一致 也就是说以下表达式都是错误的:</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">int</span> a <span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">;</span> <span class="token comment">//错误,r-value为float 而 lvalue 为int.</span>
<span class="token keyword">int</span> a <span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> a <span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> a <span class="token operator">=</span><span class="token number">2.0</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">vec3</span> a <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>GLSL中函数递归是不被允许的。其行为是未定义的。</strong></p>
<p>引用：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/66b10062bd67">https://www.jianshu.com/p/66b10062bd67</a></p>
<h1 id="HLSL的基础语法"><a href="#HLSL的基础语法" class="headerlink" title="HLSL的基础语法"></a>HLSL的基础语法</h1><p>官网文档</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-my/windows/win32/direct3dhlsl/dx-graphics-hlsl?redirectedfrom=MSDN">https://docs.microsoft.com/en-my/windows/win32/direct3dhlsl/dx-graphics-hlsl?redirectedfrom=MSDN</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/High-Level_Shading_Language">HLSL</a>(High-Level Shading Language，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E7%9D%80%E8%89%B2%E5%99%A8%E8%AF%AD%E8%A8%80">高级着色语言</a>) 是由微软开发的一种着色器语言，D3D9及以上版本使用其作为着色语言（注：D3D8的shader使用是类似于汇编的语言来编写），拥有如下特点：</p>
<ol>
<li>基于C语言的语法（如：大小写敏感，每条语句必须以分号结尾），是一门面向过程的强类型语言（type sensitive language）</li>
<li>除了bool、int、uint、half、float、double基础类型外，还支持数组类型，另外HLSL还内置了适合3D图形操作的向量与矩阵类型，以及采样器（纹理）类型  </li>
<li>基础类型的隐式转换规则与C语言一致</li>
<li>变量没有赋初值时，都会被填充为false、0或0.0</li>
<li>if条件语句和switch条件语句与C语言一致 </li>
<li>for循环语句和while循环语句与C语言一致</li>
<li>return、continue和break与C语言一致。另外引入了discard，该关键字只能在ps中使用，表示放弃当前像素，直接处理下一个像素。</li>
<li>无指针、无字符和字符串类型</li>
<li>无union、无enum</li>
<li>向量、矩阵可通过构造函数进行初始化</li>
</ol>
<p><strong>通用着色器的核心</strong></p>
<p>所有的可编程着色器阶段使用通用着色器核心来实现相同的基础功能。此外，顶点着色阶段、几何着色阶段和像素着色阶段则提供了独特的功能。</p>
<p>例如几何着色阶段可以生成新的图元或删减图元，像素着色阶段可以决定当前像素是否被抛弃等。</p>
<p>下图展示了数据是怎么流向一个着色阶段，以及通用着色器核心与着色器内存资源之间的关系：</p>
<p><img src="https://raw.githubusercontent.com/klj35/BloodSoulBlockImage/main/img/l" alt="img"> </p>
<p><strong>Input Data</strong>：顶点着色器从输入装配阶段获取数据；几何着色器则从上一个着色阶段的输出获取等等。通过给形参引入可以使用的系统值可以提供额外的输入</p>
<p><strong>Output Data</strong>：着色器生成输出的结果然后传递给管线的下一个阶段。有些输出会被通用着色器核心解释成特定用途（如顶点位置、渲染目标对应位置的值），另外一些输出则由应用程序来解释。</p>
<p><strong>Shader Code</strong>：着色器代码可以从内存读取，然后用于执行代码中所期望的内容。</p>
<p><strong>Samplers</strong>：采样器决定了如何对纹理进行采样和滤波。</p>
<p><strong>Textures</strong>：纹理可以使用采样器进行采样，也可以基于索引的方式按像素读取。</p>
<p><strong>Buffers</strong>：缓冲区可以使用读取相关的内置函数，在内存中按元素直接读取。</p>
<p><strong>Constant Buffers</strong>：常量缓冲区对常量值的读取有所优化。他们被设计用于CPU对这些数据的频繁更新，因此他们有额外的大小、布局和访问限制。</p>
<p><strong>注释</strong></p>
<p>单行注释</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Hello HLSL.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>多行注释</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*********************************
 This is my first HLSL.
 Let's take a look.
*********************************/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>预处理</strong></p>
<p>#if #elif [defined(), !defined()]  #else  #ifdef  #ifndef   #endif  // 条件编译</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST1</span>  <span class="token comment">// 定义为空的宏</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">TEST1  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST1</span> <span class="token expression"><span class="token number">1</span> </span><span class="token comment">// 定义TEST1宏为1  注：可以不用先undef TEST1宏 但会报warning X1519: 'TEST1' : macro redefinition</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">TEST1  </span><span class="token comment">// 取消TEST1宏</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST1  </span><span class="token comment">// 条件不成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">TEST1  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST1</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span>  </span><span class="token comment">// 定义为int的宏</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST2</span> <span class="token comment">// 定义为空的宏</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST1 <span class="token operator">&amp;&amp;</span> <span class="token function">defined</span><span class="token punctuation">(</span>TEST2<span class="token punctuation">)</span> </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST3</span> <span class="token expression"><span class="token boolean">true</span> </span><span class="token comment">// 定义为bool的宏</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST3  </span><span class="token comment">// 条件不成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span>TEST3  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST3<span class="token operator">==</span><span class="token boolean">true</span>  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>TEST0<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> TEST1 <span class="token operator">&amp;&amp;</span> <span class="token function">defined</span><span class="token punctuation">(</span>TEST2<span class="token punctuation">)</span> </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST4</span> <span class="token expression"><span class="token number">100</span>  </span><span class="token comment">// 定义为int的宏</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST4  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST4 <span class="token operator">&gt;</span> <span class="token number">150</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token punctuation">(</span>TEST4 <span class="token operator">&gt;</span> <span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">||</span> TEST1 </span><span class="token comment">// 进入elif分支</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">TEST4 <span class="token operator">&gt;</span> <span class="token number">160</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span> <span class="token comment">// 进入else分支</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XX2</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span>TEST4</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token punctuation">(</span>TEST4 <span class="token operator">&gt;</span> <span class="token number">110</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span> <span class="token comment">// 进入else分支</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST5</span> <span class="token expression"><span class="token number">2.0</span>  </span><span class="token comment">// 定义为float的宏</span></span>

<span class="token comment">//#if TEST5  //float不能进行条件判断  编译失败</span>
<span class="token comment">//#endif</span>

<span class="token comment">//#if TEST5&gt;0.0  //float不能进行条件判断  编译失败</span>
<span class="token comment">//#endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>#define  #undef   // 宏定义、宏取消</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST1</span> <span class="token expression"><span class="token number">100</span>  </span><span class="token comment">// 定义TEST1宏为100</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">TEST1  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">TEST1   </span><span class="token comment">// 取消TEST1宏的定义</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>TEST1<span class="token punctuation">)</span> </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token comment">// 宏必须在一行写完，多行写时必须带上 \行连接符，但要注意\后不要有空格，否则会编译失败</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MERGE</span><span class="token expression"><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> a</span><span class="token punctuation">##</span><span class="token expression">b </span><span class="token comment">// ## 字符拼接符</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>#line  // 指示下一行的行号，及当前所在的文件；该命令会修改__FILE__、__LINE__的值</p>
<p>该命令是提供给编译器使用的，程序员最好不要使用该命令</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token constant">__LINE__</span><span class="token operator">==</span><span class="token number">10</span>  </span><span class="token comment">// 判断当前行号是否为10</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token constant">__FILE__</span><span class="token operator">==</span><span class="token number">0</span>  </span><span class="token comment">// 条件成立  __FILE__始终为0</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">line</span> <span class="token expression"><span class="token number">116</span> </span><span class="token comment">// 指定下一行的行号为116</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token constant">__LINE__</span><span class="token operator">==</span><span class="token number">116</span>  </span><span class="token comment">// 条件成立</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">line</span> <span class="token expression"><span class="token number">200</span> </span><span class="token string">"test.hlsl"</span>  <span class="token comment">// 指定下一行的行号为200，当前文件的ID标识为5</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token constant">__FILE__</span><span class="token operator">==</span><span class="token number">0</span>  </span><span class="token comment">// 条件成立   __FILE__始终为0</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">// test.hlsl(204,2): error: This is an error!</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token expression">This is an error<span class="token operator">!</span> </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>#error // error命令被执行，会导致当前文件编译失败</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// E:\ModenD3D\HLSL-Development-Cookbook\book_sample\Chpater 1 - Forward Light\Ambient Light\ForwardLight.hlsl(40,2): error: This is an error! </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token expression">This is an error<span class="token operator">!</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>#pragma  // 用来控制编译器的一些行为</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span> disable <span class="token operator">:</span> <span class="token number">1519</span><span class="token punctuation">;</span> once <span class="token operator">:</span> <span class="token number">3205</span><span class="token punctuation">;</span> error <span class="token operator">:</span> <span class="token number">3206</span> <span class="token punctuation">)</span> </span><span class="token comment">// 忽略1519 warning，只报一次3205 warning，3206 warning视为error</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST1</span>  <span class="token comment">// 定义为空的宏</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TEST1</span> <span class="token expression"><span class="token number">1</span> </span><span class="token comment">// 定义TEST1宏为1  注：可以不用先undef TEST1宏 但会报warning X1519: 'TEST1' : macro redefinition</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">message</span><span class="token punctuation">(</span></span><span class="token string">"Hello HLSL."</span><span class="token expression"><span class="token punctuation">)</span> </span><span class="token comment">//Hello HLSL.</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack_matrix</span><span class="token punctuation">(</span> column_major <span class="token punctuation">)</span> </span><span class="token comment">// 将uniform参数的matrix设置成列主序（缺省）  注1：列主序生成的指令数更少，因此其效率比行主序的效率要高  注2：构造matrix时不受#pragma pack_matrix影响，始终为行主序</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">pack_matrix</span><span class="token punctuation">(</span> row_major <span class="token punctuation">)</span> </span><span class="token comment">// 将uniform参数的matrix设置成行主序</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token expression">This is an error<span class="token operator">!</span> </span><span class="token comment">// hlsl中出现error时，才会打印pragma message和warning信息</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注1：需要注意的是，hlsl中出现error时（#error或语法错误），才会打印pragma message和warning信息</p>
<p>注2：更多error、warning number说明，详见：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/hlsl-errors-and-warnings">https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/hlsl-errors-and-warnings</a></p>
<p>注3：在C++代码层中，DirectXMath数学库创建的矩阵都是行矩阵，但当矩阵从C++传递给HLSL时，HLSL默认是列矩阵的，因此传递前要进行了一次转置。如果希望不发生转置操作的话，可以添加修饰关键字row_major </p>
<p>#include // 引用其他hlsl文件 与c/c++语言用法一致</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"common.hlsl"</span> <span class="token comment">// 引用其他的hlsl文件</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>typedef</strong></p>
<p>用于类型的别名，用法与C语言一致</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> POINT<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token keyword">float</span> CFLOAT<span class="token punctuation">;</span>

POINT pt<span class="token punctuation">;</span>
CFLOAT cf1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>运算符</strong></p>
<p>除了没有指针相关的运算符外，其他的与c语言完全一致</p>
<p>注1：对于向量、矩阵类型，运算符会在各个分量上进行</p>
<p>注2：支持浮点数取模%</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> n1 <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// 取模即求余数，结果为2</span>
<span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token number">3.3</span> <span class="token operator">%</span> <span class="token number">1.6</span><span class="token punctuation">;</span> <span class="token comment">// 3.3-(int)(3.3/1.6)*1.6 = 3.3-2*1.6 = 0.1</span>
<span class="token keyword">float</span> f2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3.3</span> <span class="token operator">%</span> <span class="token number">1.6</span><span class="token punctuation">;</span> <span class="token comment">// -3.3-(int)(-3.3/1.6)*1.6 = -3.3-(-2*1.6) = -0.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>注3：二元运算中变量类型的提升规则：</p>
<p>​     ① 对于二元运算来说，如果运算符左右操作数的维度不同，那么维度较小的变量类型将会被隐式提升为维度较大的变量类型。但是这种提升仅限于标量到向量的提升，即x会变为(x, x, x)。但是不支持像float2到float3的提升。</p>
<p>​     ② 对于二元运算来说，如果运算符左右的操作数类型不同，那么低精度变量的类型将被隐式提升为高精度变量的类型，这点和C/C++是类似的。</p>
<p><strong>控制流</strong></p>
<p><strong>条件语句</strong></p>
<p>HLSL也支持<code>if</code>, <code>else</code>, <code>continue</code>, <code>break</code>, <code>switch</code>关键字，此外<code>discard</code>关键字用于像素着色阶段抛弃该像素。</p>
<p>条件的判断使用一个布尔值进行，通常由各种逻辑运算符或者比较运算符操作得到。注意向量之间的比较或者逻辑操作是得到一个存有布尔值的向量，不能够直接用于条件判断，也不能用于<code>switch</code>语句。</p>
<h2 id="判断与动态分支"><a href="#判断与动态分支" class="headerlink" title="判断与动态分支"></a>判断与动态分支</h2><p>基于值的条件分支只有在程序执行的时候被编译好的着色器汇编成两种方式：**判断(predication)<strong>和</strong>动态分支(dynamic branching)**。</p>
<p>如果使用的是判断的形式，编译器会提前计算两个不同分支下表达式的值。然后使用比较指令来基于比较结果来”选择”正确的值。</p>
<p>而动态分支使用的是跳转指令来避免一些非必要的计算和内存访问。</p>
<p>着色器程序在同时执行的时候应当选择相同的分支，以防止硬件在分支的两边执行。通常情况下，硬件会同时将一系列连续的顶点数据传入到顶点着色器并行计算，或者是一系列连续的像素单元传入到像素着色器同时运算等。</p>
<p>动态分支会由于执行分支指令所带来的开销而导致一定的性能损失，因此要权衡动态分支的开销和可以跳过的指令数目。</p>
<p>通常情况下编译器会自行选择使用判断还是动态分支，但我们可以通过重写某些属性来修改编译器的行为。我们可以在条件语句前可以选择添加下面两个属性之一：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[branch]</td>
<td align="left">缺省。根据条件值的结果，只计算其中一边的内容，会产生跳转指令。</td>
</tr>
<tr>
<td align="left">[flatten]</td>
<td align="left">两边的分支内容都会计算，然后根据条件值选择其中一边。可以避免跳转指令的产生。</td>
</tr>
</tbody></table>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">[</span>flatten<span class="token punctuation">]</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    x <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>循环语句</strong></p>
<p>HLSL也支持<code>for</code>, <code>while</code>和<code>do while</code>循环。和条件语句一样，它可能也会在基于运行时的条件值判断而产生动态分支，从而影响程序性能。用法如下：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[loop]</td>
<td align="left">缺省。默认不加属性的循环语句为loop型。</td>
</tr>
<tr>
<td align="left">[unroll]</td>
<td align="left">如果循环次数较小，我们可以使用属性<code>[unroll]</code>来展开循环，代价是产生更多的汇编指令。</td>
</tr>
</tbody></table>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">times <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
sum <span class="token operator">=</span> times<span class="token punctuation">;</span>
<span class="token punctuation">[</span>unroll<span class="token punctuation">]</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>times<span class="token operator">--</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> times<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>寄存器（register）</strong></p>
<p>用于在C++与HLSL之间传递数据，包括如下4种：</p>
<table>
<thead>
<tr>
<th><strong>寄存器</strong></th>
<th><strong>说明</strong></th>
<th><strong>上限</strong></th>
</tr>
</thead>
<tbody><tr>
<td>b</td>
<td>常量缓冲区视图 (CBV)，用于从C++传递只读数据给HLSL</td>
<td>15个常量缓冲区（共16个，系统内部保留1个）</td>
</tr>
<tr>
<td>t</td>
<td>着色器资源视图 (SRV)，用于从C++传递只读内存块或纹理数据给HLSL</td>
<td>128个</td>
</tr>
<tr>
<td>u</td>
<td>无序访问视图 (UAV)，用于可读写数据的传递</td>
<td></td>
</tr>
<tr>
<td>s</td>
<td>用于从C++传递采样器设置给HLSL</td>
<td>128个</td>
</tr>
</tbody></table>
<p>参见：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3d12/resource-binding-in-hlsl">Resource binding in HLSL</a>（<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/direct3d12/resource-binding-in-hlsl">HLSL 中的资源绑定</a>） </p>
<p><strong>变量</strong></p>
<p>变量名需要符合以下规则：</p>
<p>① 只能包括大小写字母、数字和下划线</p>
<p>② 变量名不能以数字开头</p>
<p>③ 不能是关键字或预留的关键字</p>
<p>全局变量：定义在函数体外的变量。作用域规则与c语言全局变量一致。</p>
<p>局部变量：定义在函数内的变量。作用域规则与c语言局部变量一致。</p>
<p>const变量</p>
<p>该变量为一常量，需要被初始化，在运行时不能被修改，与c/c++用法一致</p>
<p>static变量</p>
<p>进一步可分为static局部变量和static全局变量，与c/c++用法一致</p>
<p>static局部变量需要在HLSL中自己初始化，否则使用默认初始化，初始化操作仅执行一次（首次被访问时）</p>
<p>只在着色器内部可见</p>
<p>extern变量</p>
<p>在全局变量上可用，非静态的全局变量默认是extern类型</p>
<p>可在着色器外被访问，比如被C++应用程序</p>
<p>uniform变量</p>
<p>在D3D代码中初始化，然后再作为输入传给着色器</p>
<p>允许在C++应用层中修改，但在着色器执行的过程中，其值始终保持不变（运行前可变，运行时不变）。着色器程序中的全局变量默认为既uniform又extern</p>
<p>volatile变量</p>
<p>在全局变量上可用，提示效果框架该变量经常被修改</p>
<p>shared变量</p>
<p>在全局变量上可用，提示效果框架该变量可在多个效果之间共享</p>
<p>nointerpolation – 修饰的变量，在将顶点着色器的输出传递到像素着色器之前，请勿对其进行插值</p>
<p>groupshared – 将一个变量标记为用于计算着色器的线程组共享内存</p>
<p>precise – 用于保证该变量在计算时，是严格精确的</p>
<p>row_major – 标记一个可在单个行中存储4个成分的变量，以便可以将它们存储在单个常量寄存器中</p>
<p>column_major – 标记一个可在单个列中存储4个成分的变量，以优化矩阵数学 （缺省）</p>
<h2 id="语义"><a href="#语义" class="headerlink" title="语义"></a><strong>语义</strong></h2><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-semantics">语义</a>通常是附加在着色器输入/输出参数上的字符串。它在着色器程序的用途如下：</p>
<ol>
<li>用于描述传递给着色器程序的变量参数的含义</li>
<li>允许着色器程序接受由渲染管线生成的特殊系统值</li>
<li>允许着色器程序传递由渲染管线解释的特殊系统值</li>
</ol>
<h3 id="vs语义"><a href="#vs语义" class="headerlink" title="vs语义"></a>vs语义</h3><table>
<thead>
<tr>
<th align="left">语义</th>
<th align="left">描述</th>
<th align="left">是否可作为输入关联</th>
<th align="left">是否可作为输出关联</th>
<th align="left">类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BINORMAL[n]</td>
<td align="left">副法线（副切线）向量</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">BLENDINDICES[n]</td>
<td align="left">混合索引</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">uint</td>
</tr>
<tr>
<td align="left">BLENDWEIGHT[n]</td>
<td align="left">混合权重</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">COLOR[n]</td>
<td align="left">漫反射/镜面反射颜色</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">NORMAL[n]</td>
<td align="left">法向量</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">POSITION[n]</td>
<td align="left">物体坐标系下的顶点坐标</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">PSIZE[n]</td>
<td align="left">点的大小</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">TANGENT[n]</td>
<td align="left">切线向量</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">TEXCOORD[n]</td>
<td align="left">纹理坐标</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">FOG</td>
<td align="left">顶点雾</td>
<td align="left"></td>
<td align="left">Yes</td>
<td align="left">float</td>
</tr>
</tbody></table>
<p>注1：n是一个可选的整数，从0开始。比如POSITION0, TEXCOORD1等等。 注2：vs的输出关联将其运算得到的结果经过光栅化插值后链接到ps的输入关联上.</p>
<h3 id="ps语义"><a href="#ps语义" class="headerlink" title="ps语义"></a><strong>ps语义</strong></h3><table>
<thead>
<tr>
<th align="left">语义</th>
<th align="left">描述</th>
<th align="left">是否可作为输入关联</th>
<th align="left">是否可作为输出关联</th>
<th align="left">类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">COLOR[n]</td>
<td align="left">漫反射/镜面反射颜色</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">TEXCOORD[n]</td>
<td align="left">纹理坐标</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">VFACE</td>
<td align="left">负数表示为背面正数表示为正面</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">VPOS</td>
<td align="left">像素所在坐标</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">float2</td>
</tr>
<tr>
<td align="left">DEPTH[n]</td>
<td align="left">深度值</td>
<td align="left"></td>
<td align="left">Yes</td>
<td align="left">float</td>
</tr>
</tbody></table>
<p>注： ps输出关联将其输出颜色绑定给正确的RT上（渲染目标）。其中颜色输出被连接到alpha混合阶段，DEPTH输出关联用于改变当前光栅化位置的目标深度值</p>
<h2 id="系统值语义"><a href="#系统值语义" class="headerlink" title="系统值语义"></a><strong>系统值语义</strong></h2><p>所有的系统值都包含前缀<code>SV_</code>，后面的部分大小写不敏感，例如：SV_Positon和SV_POSITION是一样的。这些系统值将用于某些着色器的特定用途。</p>
<table>
<thead>
<tr>
<th align="left">系统值</th>
<th align="left">描述</th>
<th align="left">类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SV_Depth</td>
<td align="left">深度缓冲区数据，可以被任何着色器写入/读取</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">SV_InstanceID</td>
<td align="left">每个实例都会在运行期间自动生成一个ID。在任何着色器阶段都能读取</td>
<td align="left">uint</td>
</tr>
<tr>
<td align="left">SV_IsFrontFace</td>
<td align="left">指定该三角形是否为正面。可以被几何着色器写入，以及可以被像素着色器读取</td>
<td align="left">bool</td>
</tr>
<tr>
<td align="left">SV_Position</td>
<td align="left">若被声明用于输入到着色器，它描述的是像素位置，在所有着色器中都可用，可能会有0.5的偏移值</td>
<td align="left">float4</td>
</tr>
<tr>
<td align="left">SV_PrimitiveID</td>
<td align="left">每个原始拓扑都会在运行期间自动生成一个ID。可用在几何/像素着色器中写入，也可以在像素/几何/外壳/域着色器中读取</td>
<td align="left">uint</td>
</tr>
<tr>
<td align="left">SV_StencilRef</td>
<td align="left">代表当前像素着色器的模板引用值。只可以被像素着色器写入</td>
<td align="left">uint</td>
</tr>
<tr>
<td align="left">SV_VertexID</td>
<td align="left">每个实例都会在运行期间自动生成一个ID。仅允许作为顶点着色器的输入</td>
<td align="left">uint</td>
</tr>
<tr>
<td align="left">SV_TARGET</td>
<td align="left">SV_TARGET即Color缓存区（帧缓存，FrameBuffer）</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_TARGET[n] 0 &lt;= n &lt;= 7</td>
<td align="left">MRT有多个RenderTarget输出</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_ClipDistance0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_RenderTargetArrayIndex</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_TessFactor</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_InsideTessFactor</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_DomainLocation</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_GroupID</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_GroupIndex</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_GroupThreadID</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SV_DispatchThreadID</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="着色器常量"><a href="#着色器常量" class="headerlink" title="着色器常量"></a><strong>着色器常量</strong></h2><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-constants">着色器常量</a>存在内存中的一个或多个缓冲区资源当中。他们可以被组织成两种类型的缓冲区：常量缓冲区（cbuffers）和纹理缓冲区（tbuffers）。</p>
<h2 id="常量缓冲区-Constant-Buffer"><a href="#常量缓冲区-Constant-Buffer" class="headerlink" title="常量缓冲区(Constant Buffer)"></a><strong>常量缓冲区(Constant Buffer)</strong></h2><p>常量缓冲区允许C++端将数据传递给HLSL中使用，在HLSL中，这些传递过来的数据不可更改，因而是常量。常量缓冲区对这种使用方式有所优化，表现为低延迟的访问和允许来自CPU的频繁更新，因此他们有额外的大小、布局和访问限制。</p>
<p>① 每个着色器阶段最多允许15个常量缓冲区（共16个，系统内部保留1个），并且每个缓冲区最多可以容纳4096个标量（每个vector最多包含4个float类型）。HLSL的cbuffer需要指定register(b#), #的范围为0到14</p>
<p>② 在C++创建常量缓冲区时大小必须为16字节的倍数，因为HLSL的常量缓冲区本身以及对它的读写操作需要严格按16字节对齐</p>
<p>③ 对常量缓冲区的成员使用packoffset修饰符可以指定起始向量和分量位置</p>
<p>④ 在更新常量缓冲区时由于数据是提交完整的字节流数据到GPU，会导致HLSL中cbuffer的所有成员都被更新。为了减少不必要的更新，可以根据这些参数的更新频率划分出多个常量缓冲区以节省带宽资源</p>
<p>⑤ 一个着色器在使用了多个常量缓冲区的情况下，这些常量缓冲区相互间都不能出现同名成员</p>
<p>⑥ 单个常量缓冲区可以同时绑定到不同的可编程着色器阶段，因为这些缓冲区都是只读的，不会导致内存访问冲突。</p>
<p>   一个包含常量缓冲区的*.hlsli文件同时被多个着色器文件引用，只是说明这些着色器使用相同的常量缓冲区布局，如果该缓冲区需要在多个着色器阶段使用，你还需要在C++同时将相同的常量缓冲区绑定到各个着色器阶段上</p>
<p>当我们在HLSL中声明常量缓冲区时，还<strong>需要在HLSL的声明中使用关键字<code>register</code>手动指定对应的寄存器索引</strong>，然后编译器会为对应的着色器阶段自动将其映射到15个常量缓冲寄存器的其中一个位置。这些寄存器的名字为<code>b0</code>到<code>b14</code>：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/****************************** C++ ******************************/</span>
<span class="token keyword">struct</span> <span class="token class-name">VS_CONSTANT_BUFFER</span>
<span class="token punctuation">{</span>
    D3DXMATRIX mWorldViewProj<span class="token punctuation">;</span>

    D3DXVECTOR4 vSomeVectorThatMayBeNeededByASpecificShader<span class="token punctuation">;</span>
    <span class="token keyword">float</span> fSomeFloatThatMayBeNeededByASpecificShader<span class="token punctuation">;</span>
    
    <span class="token keyword">float</span> fTime<span class="token punctuation">;</span>

    <span class="token keyword">float</span> fSomeFloatThatMayBeNeededByASpecificShader2<span class="token punctuation">;</span>
    <span class="token keyword">float</span> fSomeFloatThatMayBeNeededByASpecificShader3<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">/***************************** HLSL *****************************/</span>
<span class="token comment">// 在cb0中，第一个 mWorldViewProj : packoffset(c0)表示将会在这个cbuffer中的c0位置开始存储 mWorldViewProj,共使用c0,c1,c2,c3</span>
<span class="token comment">// 由于D3DXVECTOR4 vSomeVectorThatMayBeNeededByASpecificShader占据了c4，float fSomeFloatThatMayBeNeededByASpecificShader占据了c5.x，所以float fTime就是c5.y了</span>

<span class="token comment">// 在C++代码层中，D3DXMATRIX矩阵是行矩阵，但当矩阵从C++传递给HLSL时，HLSL默认是列矩阵的，因此传递前要进行了一次转置。如果希望不发生转置操作的话，则需要添加修饰关键字row_major </span>
cbuffer cb0
<span class="token punctuation">{</span>
    row_major float4x4 mWorldViewProj <span class="token operator">:</span> <span class="token function">packoffset</span><span class="token punctuation">(</span>c0<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> fTime <span class="token operator">:</span> <span class="token function">packoffset</span><span class="token punctuation">(</span>c5<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注1：常量缓冲区（constant buffer views，CBV）用b寄存器来传递 </p>
<p>注2：packoffset(c0)表示起始位置为c0，其中c为一个float4的向量(x,y,z,w)</p>
<p>在C++端是通过ID3D11DeviceContext::VSSetConstantBuffers、ID3D11DeviceContext::PSSetConstantBuffers指定特定的槽(slot)来给某一着色器阶段对应的寄存器索引提供常量缓冲区的数据。</p>
<p>如果是存在多个不同的着色器阶段使用同一个常量缓冲区，那就需要分别给这两个着色器阶段设置好相同的数据。</p>
<p>综合前面几节内容，下面演示了顶点着色器和常量缓冲区的用法：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cbuffer ConstantBuffer <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b0<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    float4x4 g_WorldViewProj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">VS_Main</span><span class="token punctuation">(</span>
    in float4 inPos <span class="token operator">:</span> POSITION<span class="token punctuation">,</span>         <span class="token comment">// 绑定变量到输入装配器</span>
    in uint VID <span class="token operator">:</span> SV_VertexID<span class="token punctuation">,</span>          <span class="token comment">// 绑定变量到系统生成值</span>
    out float4 outPos <span class="token operator">:</span> SV_Position<span class="token punctuation">)</span>    <span class="token comment">// 告诉管线将该值解释为输出的顶点位置</span>
<span class="token punctuation">{</span>
    outPos <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>inPos<span class="token punctuation">,</span> g_WorldViewProj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的代码也可以写成：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cbuffer ConstantBuffer <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b0<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    float4x4 g_WorldViewProj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexIn</span>
<span class="token punctuation">{</span>
    float4 inPos <span class="token operator">:</span> POSITION<span class="token punctuation">;</span>    <span class="token comment">// 源自输入装配器</span>
    uint VID <span class="token operator">:</span> SV_VertexID<span class="token punctuation">;</span>        <span class="token comment">// 源自系统生成值</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

float4 <span class="token function">VS_Main</span><span class="token punctuation">(</span>VertexIn vIn<span class="token punctuation">)</span> <span class="token operator">:</span> SV_Position
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">mul</span><span class="token punctuation">(</span>vIn<span class="token punctuation">.</span>inPos<span class="token punctuation">,</span> g_WorldViewProj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>纹理缓冲区（Texture Buffer）</strong></p>
<p>纹理缓冲区（tbuffer）并不是用来存储纹理的，而是指可以像纹理那样来访问其中的数据，对于索引类数据有更好的性能。这些数据也是只读的。vs、ps阶段分别最多可以绑定128个tbuffer。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">tbuffer mytb <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>t0<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">float</span> weight<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 可以从CPU更新，只读</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>有类型的缓冲区(Typed Buffer)</strong></p>
<p>这是一种创建和使用起来最简单的缓冲区，其数据可以在HLSL被解释成基本HLSL类型的数组形式。</p>
<p><strong>Buffer（只读的缓冲区类型）</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Buffer<span class="token operator">&lt;</span>float4<span class="token operator">&gt;</span> g_Buffer <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>t0<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>RWBuffer（可读写的缓冲区类型）</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">RWBuffer<span class="token operator">&lt;</span>float4<span class="token operator">&gt;</span> g_RWBuffer <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>u0<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>结构化缓冲区（Struct Buffer）</strong></p>
<p>StructuredBuffer（只读的结构化缓冲区）</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">TBokeh</span>
<span class="token punctuation">{</span>
    float2 Pos<span class="token punctuation">;</span>
    <span class="token keyword">float</span> Radius<span class="token punctuation">;</span>
    float4 Color<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
StructuredBuffer<span class="token operator">&lt;</span>TBokeh<span class="token operator">&gt;</span> Bokeh <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> t0 <span class="token punctuation">)</span><span class="token punctuation">;</span>
StructuredBuffer<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> AvgLum <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> t1 <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>RWStructuredBuffer（可读写的结构化缓冲区）</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Single raindrop structure</span>
<span class="token keyword">struct</span> <span class="token class-name">RainDrop</span>
<span class="token punctuation">{</span>
    float3 Pos<span class="token punctuation">;</span>
    float3 Vel<span class="token punctuation">;</span>
    <span class="token keyword">float</span> State<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Raindrop buffer</span>
RWStructuredBuffer<span class="token operator">&lt;</span>RainDrop<span class="token operator">&gt;</span> RainData <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> u0 <span class="token punctuation">)</span><span class="token punctuation">;</span>
RWStructuredBuffer<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> AverageLum <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> u1 <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>追加/消耗缓冲区(Append/Consume Buffer)</strong></p>
<p>追加缓冲区和消耗缓冲区类型实际上是结构化缓冲区的特殊变体资源。因为涉及到修改操作，它们只能使用乱序访问视图（unordered access view，UAV）来绑定，用u寄存器来传递。</p>
<p>如果你只是希望这些结构体数据经过着色器变换并且不需要考虑最终的输出顺序要一致，那么使用这两个缓冲区是一种不错的选择。</p>
<p>AppendStructuredBuffer</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">TBokeh</span>
<span class="token punctuation">{</span>
    float2 Pos<span class="token punctuation">;</span>
    <span class="token keyword">float</span> Radius<span class="token punctuation">;</span>
    float4 Color<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
AppendStructuredBuffer<span class="token operator">&lt;</span>TBokeh<span class="token operator">&gt;</span> BokehStack <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> u0 <span class="token punctuation">)</span><span class="token punctuation">;</span>

AppendStructuredBuffer<span class="token operator">&lt;</span>float3<span class="token operator">&gt;</span> g_VertexOut <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ConsumeStructuredBuffer</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">ConsumeStructuredBuffer<span class="token operator">&lt;</span>float3<span class="token operator">&gt;</span> g_VertexIn <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>u0<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>字节地址缓冲区(Byte Address Buffer)</strong></p>
<p>字节地址缓冲区为HLSL程序提供了一种更为原始的内存块，程序员自己负责解析内存块的内容</p>
<p>ByteAddressBuffer（只读的字节地址缓冲区）</p>
<p>使用着色器资源视图（shader resource views，SRV）来绑定，用t寄存器来传递</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">ByteAddressBuffer g_ByteAddressBuffer <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>t0<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>RWByteAddressBuffer（可读写的结构化缓冲区）</p>
<p>不仅支持写入，还支持原子操作。使用乱序访问视图（unordered access view，UAV）来绑定，用u寄存器来传递。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">RWByteAddressBuffer g_RWByteAddressBuffer <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>u0<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>基础类型</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 布尔型</span>
<span class="token keyword">bool</span> b1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> b2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// b2=true</span>

<span class="token comment">// 32位有符号整型</span>
<span class="token keyword">int</span> n1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> n4 <span class="token operator">=</span> <span class="token number">0.9</span><span class="token punctuation">;</span> <span class="token comment">// 取整数部分  n4=0</span>
<span class="token keyword">int</span> n5 <span class="token operator">=</span> <span class="token number">3L</span><span class="token punctuation">;</span> <span class="token comment">// n5=3</span>
<span class="token keyword">int</span> n6 <span class="token operator">=</span> <span class="token number">0x14</span><span class="token punctuation">;</span> <span class="token comment">// 16进制 n6=20</span>
<span class="token keyword">int</span> n7 <span class="token operator">=</span> <span class="token number">027</span><span class="token punctuation">;</span> <span class="token comment">// 8进制 n7=23</span>
<span class="token keyword">int</span> n8 <span class="token operator">=</span> b1<span class="token punctuation">;</span> <span class="token comment">// n8=1</span>

<span class="token comment">// 32位无符号整型</span>
uint u1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
uint u2 <span class="token operator">=</span> <span class="token number">1u</span><span class="token punctuation">;</span>
uint u3 <span class="token operator">=</span> <span class="token number">100L</span><span class="token punctuation">;</span>
uint u4 <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">;</span><span class="token comment">// 取整数部分  u4=1</span>
uint u5 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">;</span><span class="token comment">// 赋值为负数时  u5=0</span>
uint u6 <span class="token operator">=</span> b1<span class="token punctuation">;</span><span class="token comment">// u6=1</span>

<span class="token comment">// dword类型与uint类型等价</span>
dword dw1 <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
dword dw2 <span class="token operator">=</span> <span class="token number">0.9</span><span class="token punctuation">;</span><span class="token comment">// 取整数部分  dw2=0</span>
dword dw3 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2.8f</span><span class="token punctuation">;</span><span class="token comment">// 赋值为负数时  dw3=0</span>

<span class="token comment">// 64位双精度浮点型</span>
<span class="token keyword">double</span> d1 <span class="token operator">=</span> <span class="token number">200UL</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> d2 <span class="token operator">=</span> dw1<span class="token punctuation">;</span>
<span class="token keyword">double</span> d3 <span class="token operator">=</span> <span class="token number">20.8f</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> d4 <span class="token operator">=</span> <span class="token number">320.5</span><span class="token punctuation">;</span>

<span class="token comment">// 32位单精度浮点型</span>
<span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">250.6</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> f2 <span class="token operator">=</span> <span class="token number">130.0f</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> f3 <span class="token operator">=</span> d3<span class="token punctuation">;</span>

<span class="token comment">// 16位单精度浮点型</span>
half h1 <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
half h2 <span class="token operator">=</span> n6<span class="token punctuation">;</span> <span class="token comment">// h2=20</span>
half h3 <span class="token operator">=</span> d4<span class="token punctuation">;</span> <span class="token comment">// h3=320.5</span>
half h4 <span class="token operator">=</span> f2<span class="token punctuation">;</span> <span class="token comment">// h4=130.0f</span>
half h5 <span class="token operator">=</span> f1 <span class="token operator">+</span> d1<span class="token punctuation">;</span> <span class="token comment">// h5=-50.6</span>

<span class="token comment">// 基础类型强制转换</span>
<span class="token keyword">bool</span> b3 <span class="token operator">=</span> <span class="token keyword">bool</span><span class="token punctuation">(</span>n3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b3=false  支持c类型的转换方式</span>
<span class="token keyword">int</span> n9 <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// n9=-250  支持c类型的转换方式</span>
uint u7 <span class="token operator">=</span> <span class="token punctuation">(</span>uint<span class="token punctuation">)</span>f1<span class="token punctuation">;</span> <span class="token comment">// u7=0</span>
uint u8 <span class="token operator">=</span> <span class="token punctuation">(</span>uint<span class="token punctuation">)</span>d3<span class="token punctuation">;</span> <span class="token comment">// u8=20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注：有些平台可能不支持int、half和double，这种情况下，这些类型将用float来模拟</p>
<p><strong>数组</strong></p>
<p>除了一维数组外，允许有多维数组</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">float</span> fa1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// fa1 = {0.0, 0.0, 0.0, 0.0, 0.0}</span>
<span class="token keyword">int</span> ia1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span> <span class="token punctuation">,</span><span class="token number">2</span> <span class="token punctuation">,</span><span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
uint ua1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
vector va1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.13</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
float1x2 ma1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>结构体（struct）</strong></p>
<p>① 可从其他结构体上派生</p>
<p>② 与C语言结构体一样，不允许有构造函数和析构函数</p>
<p>③ 不能直接对2个结构体变量进行比较</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">base</span> <span class="token punctuation">{</span> <span class="token keyword">float</span> param<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">light</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">base</span> <span class="token comment">// 可从另外一个结构体上继承</span></span>
<span class="token punctuation">{</span>
    vector color<span class="token punctuation">;</span>
    float3 position<span class="token punctuation">;</span>

    <span class="token comment">//light(){} // 与C语言一样，不允许有构造函数</span>
    <span class="token comment">//~light(){} // 与C语言一样，不允许有析构函数</span>

    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        param <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
        color<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//base s1 = base(2.5); //编译错误 error X3037: constructors only defined for numeric base types</span>
<span class="token comment">//light s2 = light(2.1, vector(1.0, 1.0, 0.0, 1.0), float3(10.0, 10.0, 0.0));//编译错误 error X3037: constructors only defined for numeric base types</span>
light s3<span class="token punctuation">,</span> s4<span class="token punctuation">;</span>
<span class="token comment">//if (s3 == s4) {}// 结构体不能直接比较  编译错误 error X3020 : type mismatch</span>

s3<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>向量</strong></p>
<p>向量的分量可以为：</p>
<p>① {x,y,z,w} ： 用来获取顶点坐标分量</p>
<p>② {r,g,b,a} ： 用来获取颜色分量</p>
<p>从向量中可以同时抽取多个分量，这个过程称作混合（swizzle，或重组、重排）。但要注意地是，以上两种不能相互混着使用，如：xyr、rgyz等</p>
<table>
<thead>
<tr>
<th><strong>分量类型</strong></th>
<th><strong>1维</strong></th>
<th><strong>2维</strong></th>
<th><strong>3维</strong></th>
<th><strong>4维</strong></th>
</tr>
</thead>
<tbody><tr>
<td>bool</td>
<td>bool1 // vector&lt;bool,1&gt;</td>
<td>bool2 // vector&lt;bool,2&gt;</td>
<td>bool3 // vector&lt;bool,3&gt;</td>
<td>bool4 // vector&lt;bool,4&gt;</td>
</tr>
<tr>
<td>int</td>
<td>int1 // vector&lt;int,1&gt;</td>
<td>int2 // vector&lt;int,2&gt;</td>
<td>int3 // vector&lt;int,3&gt;</td>
<td>int4 // vector&lt;int,4&gt;</td>
</tr>
<tr>
<td>uint</td>
<td>uint1 // vector&lt;uint,1&gt;</td>
<td>uint2 // vector&lt;uint,2&gt;</td>
<td>uint3 // vector&lt;uint,3&gt;</td>
<td>uint4 // vector&lt;uint,4&gt;</td>
</tr>
<tr>
<td>half</td>
<td>half1 // vector&lt;half,1&gt;</td>
<td>half2 // vector&lt;half,2&gt;</td>
<td>half3 // vector&lt;half,3&gt;</td>
<td>half4 // vector&lt;half,4&gt;</td>
</tr>
<tr>
<td>float</td>
<td>float1 // vector&lt;float,1&gt;</td>
<td>float2 // vector&lt;float,2&gt;</td>
<td>float3 // vector&lt;float,3&gt;</td>
<td>float4 // vector&lt;float,4&gt; 即vector</td>
</tr>
<tr>
<td>double</td>
<td>double1 // vector&lt;double,1&gt;</td>
<td>double2 // vector&lt;double,2&gt;</td>
<td>double3 // vector&lt;double,3&gt;</td>
<td>double4 // vector&lt;double,4&gt;</td>
</tr>
</tbody></table>
<p>注1：vector为一个4维向量，各元素的类型为float</p>
<p>注2：vector&lt;T, n&gt;为一个n维向量（n必须介于1~4之间），各元素的类型为T</p>
<p>注3：当N&gt;n时，可裁剪降维后自动隐式转换  N –&gt; n</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 向量 vector为4维float类型向量</span>
vector v1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
vector v2<span class="token punctuation">;</span> <span class="token comment">// v2 = { 0.0, 0.0, 0.0, 0.0 }</span>
v2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// v2 = { 1.0, 0.0, 0.0, 0.0 }</span>
v2<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// v2 = { 1.0, 0.0, 1.0, 0.0 }</span>
v2<span class="token punctuation">.</span>g <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// v2 = { 1.0, 1.0, 1.0, 0.0 }</span>

<span class="token comment">// 混合（swizzle）</span>
vector v3 <span class="token operator">=</span> v1<span class="token punctuation">.</span>yzwx<span class="token punctuation">;</span> <span class="token comment">// v3 = { 1.0, 0.0, 0.0, 0.0 } 等价于 v3.x=v1.y; v3.y=v1.z; v3.z=v1.w; v3.w=v1.x;</span>
vector v4 <span class="token operator">=</span> v1<span class="token punctuation">.</span>rbga<span class="token punctuation">;</span> <span class="token comment">// v4 = { 0.0, 0.0, 1.0, 0.0 }  等价于 v4.x=v1.r; v4.y=v1.b; v4.z=v1.g; v4.w=v1.a;</span>
vector v5 <span class="token operator">=</span> <span class="token function">vector</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// v5 = { 0.5, 0.2, 1.0, 0.0 }  新构造方法</span>
v5<span class="token punctuation">.</span>xz <span class="token operator">=</span> v1<span class="token punctuation">;</span> <span class="token comment">// v5 = { 0.0, 0.2, 0.0, 0.0 }  只将v1的xz分量赋值给v5，等价于 v5.x=v1.x; v5.z=v1.z;</span>

<span class="token comment">//vector v6 = vector(0.95); // 编译错误  error X3014: incorrect number of arguments to numeric-type constructor</span>
vector v6 <span class="token operator">=</span> <span class="token punctuation">(</span>vector<span class="token punctuation">)</span><span class="token number">0.95</span><span class="token punctuation">;</span> <span class="token comment">// v6 = { 0.95, 0.95, 0.95, 0.95 }</span>

vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> v7 <span class="token operator">=</span> v1<span class="token punctuation">;</span> <span class="token comment">// vector&lt;float, 4&gt;即vector类型  v7 = { 0.0, 1.0, 0.0, 0.0 }</span>

<span class="token comment">// 向量运算</span>
vector v8 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.6</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
vector v9 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
vector v10 <span class="token operator">=</span> v8 <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// v10 = {0.4, -1.6, 0.6, 1.2}</span>
vector v11 <span class="token operator">=</span> v8 <span class="token operator">+</span> <span class="token number">0.6</span><span class="token punctuation">;</span> <span class="token comment">// v11 = {0.8, -0.2, 0.9, 1.2}</span>
vector v12 <span class="token operator">=</span> v8 <span class="token operator">+</span> v9<span class="token punctuation">;</span> <span class="token comment">// v12 = { 0.2, -0.3, 1.3, 0.8 }</span>
vector v13 <span class="token operator">=</span> v8 <span class="token operator">*</span> v9<span class="token punctuation">;</span> <span class="token comment">// v13 = {0.0, -0.4, 0.3, 0.12}</span>

<span class="token comment">// 逐分量进行比较</span>
vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> v14 <span class="token operator">=</span> <span class="token punctuation">(</span>v8 <span class="token operator">&gt;</span> v9<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// v14 = {true, false, false, true}</span>

<span class="token comment">// 点乘(内积)</span>
<span class="token keyword">float</span> ret1 <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>v8<span class="token punctuation">,</span> v9<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.2*0.0+(-0.8)*0.5+0.3*1.0+0.6*0.2 = 0.02</span>
<span class="token comment">// 叉乘(外积)  3维向量特有</span>
vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> vf3Ret <span class="token operator">=</span> <span class="token function">cross</span><span class="token punctuation">(</span>v8<span class="token punctuation">.</span>xyz<span class="token punctuation">,</span> v9<span class="token punctuation">.</span>xyz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// vf3Ret.x=v8.y*v9.z-v8.z*v9.y = -0.8*1.0-0.3*0.5   = -0.95</span>
                                                 <span class="token comment">// vf3Ret.y=v8.z*v9.x-v8.x*v9.z = 0.3*0.0-0.2*1.0    = -0.2</span>
                                                 <span class="token comment">// vf3Ret.z=v8.x*v9.y-v8.y*v9.x = 0.2*0.5-(-0.8)*0.0 = 0.1</span>

vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">&gt;</span> vi3a<span class="token punctuation">;</span> <span class="token comment">// vi3a = {0, 0, 0}</span>
vi3a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment">// vi3a = {0, 0, 10}</span>

vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">&gt;</span> vb2a<span class="token punctuation">;</span> <span class="token comment">// vb2a = {false, false}</span>
vb2a<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// vb2a = {true, false}</span>

<span class="token comment">// float4即vector</span>
float4 vf4a<span class="token punctuation">;</span> <span class="token comment">// vf4a = { 0.0, 0.0, 0.0, 0.0 }</span>
vf4a <span class="token operator">=</span> v2<span class="token punctuation">;</span> <span class="token comment">// vf4a = { 1.0, 1.0, 1.0, 0.0 }</span>

float1 vf1a <span class="token operator">=</span> <span class="token number">0.75</span><span class="token punctuation">;</span> <span class="token comment">// float3即vector&lt;float,1&gt; 即float类型</span>
<span class="token keyword">float</span> f1 <span class="token operator">=</span> vf1a<span class="token punctuation">;</span> <span class="token comment">// f1为0.75</span>
<span class="token keyword">float</span> f2 <span class="token operator">=</span> vf1a<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token comment">// f2为0.75</span>
<span class="token keyword">float</span> f3 <span class="token operator">=</span> vf1a<span class="token punctuation">.</span>r<span class="token punctuation">;</span> <span class="token comment">// f3为0.75</span>

float2 vf2a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.9</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// float2即vector&lt;float,2&gt;</span>
float3 vf3a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.35</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// float3即vector&lt;float,3&gt;</span>
float3 vf3b<span class="token punctuation">;</span> <span class="token comment">// vf3b = { 0.0, 0.0, 0.0 }</span>

<span class="token comment">//vf3b = vf2a; // error 编译错误  低维向量不允许赋值给高维向量</span>
float2 vf2b <span class="token operator">=</span> vf3a<span class="token punctuation">;</span> <span class="token comment">// vf2b = { 0.2, 0.35 } 当N&gt;n时，可裁剪降维后自动隐式转换   N --&gt; n</span>
vf3b <span class="token operator">=</span> <span class="token function">float3</span><span class="token punctuation">(</span>vf2a<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// vf3b = { 0.8, 0.9, 1.0 }</span>
vf3b <span class="token operator">=</span> <span class="token function">float3</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> vf2a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// vf3b = { 0.3, 0.8, 0.9 }</span>
vf3b <span class="token operator">=</span> <span class="token function">float3</span><span class="token punctuation">(</span>vf1a<span class="token punctuation">,</span> vf2a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// vf3b = { 0.75, 0.8, 0.9 }</span>
vf3b <span class="token operator">=</span> v1<span class="token punctuation">;</span>  <span class="token comment">// vf3b = { 0.0, 1.0, 0.0 };  高维向量可赋值给低维向量  后面的部分会被截断</span>

float4 vf4b <span class="token operator">=</span> <span class="token punctuation">{</span> vf2a<span class="token punctuation">,</span> vf2a <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// vf4b = { 0.8, 0.9, 0.8, 0.9 }</span>
float4 vf4c <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.7</span><span class="token punctuation">,</span> vf2a<span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// vf4c = { 0.7, 0.8, 0.9, 0.5 }</span>
float4 vf4d <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.7</span><span class="token punctuation">,</span> vf3a <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// vf4d = { 0.7, 0.2, 0.35, 0.5 }</span>

bool2 vb2b<span class="token punctuation">;</span> <span class="token comment">// bool2即vector&lt;bool,2&gt;</span>
int2 vi2a<span class="token punctuation">;</span> <span class="token comment">// int2即vector&lt;int,2&gt;</span>
uint2 vu2a<span class="token punctuation">;</span> <span class="token comment">// uint2即vector&lt;uint,2&gt;</span>
<span class="token comment">// dword2 vdw2a; // error 编译错误  不存在dword2类型</span>
half2 vh2a<span class="token punctuation">;</span> <span class="token comment">// half2即vector&lt;half,2&gt;</span>
double2 vd2a<span class="token punctuation">;</span> <span class="token comment">// double2即vector&lt;double,2&gt;</span>
vf2a <span class="token operator">=</span> vb2b<span class="token punctuation">;</span>
vf2a <span class="token operator">=</span> vi2a<span class="token punctuation">;</span>
vf2a <span class="token operator">=</span> vu2a<span class="token punctuation">;</span>
vf2a <span class="token operator">=</span> vh2a<span class="token punctuation">;</span>
vf2a <span class="token operator">=</span> vd2a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>矩阵</strong></p>
<p>按照行优先顺序来存储（行主序）</p>
<table>
<thead>
<tr>
<th><strong>分量类型</strong></th>
<th><strong>matrix类型</strong></th>
<th><strong>m x n // m行n列</strong></th>
</tr>
</thead>
<tbody><tr>
<td>bool</td>
<td>matrix&lt;bool, m, n&gt;</td>
<td>bool1x1、bool1x2、bool1x3、bool1x4bool2x1、bool2x2、bool2x3、bool2x4bool3x1、bool3x2、bool3x3、bool3x4bool4x1、bool4x2、bool4x3、bool4x4</td>
</tr>
<tr>
<td>int</td>
<td>matrix&lt;int, m, n&gt;</td>
<td>int1x1、int1x2、int1x3、int1x4int2x1、int2x2、int2x3、int2x4int3x1、int3x2、int3x3、int3x4　　int4x1、int4x2、int4x3、int4x4</td>
</tr>
<tr>
<td>uint</td>
<td>matrix&lt;uint, m, n&gt;</td>
<td>uint1x1、uint1x2、uint1x3、uint1x4uint2x1、uint2x2、uint2x3、uint2x4uint3x1、uint3x2、uint3x3、uint3x4uint4x1、uint4x2、uint4x3、uint4x4</td>
</tr>
<tr>
<td>half</td>
<td>matrix&lt;half, m, n&gt;</td>
<td>half1x1、half1x2、half1x3、half1x4half2x1、half2x2、half2x3、half2x4half3x1、half3x2、half3x3、half3x4half4x1、half4x2、half4x3、half4x4</td>
</tr>
<tr>
<td>float</td>
<td>matrix&lt;float, m, n&gt;</td>
<td>float1x1、float1x2、float1x3、float1x4float2x1、float2x2、float2x3、float2x4float3x1、float3x2、float3x3、float3x4float4x1、float4x2、float4x3、float4x4 注：matrix即为float4x4</td>
</tr>
<tr>
<td>double</td>
<td>matrix&lt;double, m, n&gt;</td>
<td>double1x1、double1x2、double1x3、double1x4double2x1、double2x2、double2x3、double2x4double3x1、double3x2、double3x3、double3x4double4x1、double4x2、double4x3、double4x4</td>
</tr>
</tbody></table>
<p>注1：matrix为一个4x4 float矩阵</p>
<p>注2：matrix&lt;T, m, n&gt;为一个m x n（m、n必须介于1~4之间），各元素的类型为T</p>
<p>注3：当M&gt;m且N&gt;n时，可裁剪降维后自动隐式转换  M x N –&gt; m x n</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">float2 f2a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token number">1.8</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
float3 f3a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
float2x2 m2x2a<span class="token punctuation">;</span> <span class="token comment">// m2x2a = {0.0, 0.0, 0.0, 0.0}</span>
float2x2 m2x2b <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.9</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// m2x2b = {0.8, 0.6, 2.0, 0.9}</span>
                                         <span class="token comment">//          | 0.8  0.6 |</span>
                                         <span class="token comment">//          | 2.0  0.9 |</span>
float2x2 m2x2c <span class="token operator">=</span> <span class="token function">float2x2</span><span class="token punctuation">(</span> f3a<span class="token punctuation">,</span> <span class="token number">0.1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// m2x2c = {0.0, -1.0, 3.0, 0.1}</span>
                                       <span class="token comment">//          | 0.0  -1.0 |</span>
                                       <span class="token comment">//          | 3.0   0.1 |</span>
<span class="token comment">//float2x2 m2x2d = float2x2(f2a, f3a);  // 编译出错  error X3014: incorrect number of arguments to numeric-type constructor</span>
float2x2 m2x2e <span class="token operator">=</span> <span class="token function">float2x2</span><span class="token punctuation">(</span>f2a<span class="token punctuation">,</span> f3a<span class="token punctuation">.</span>xz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// m2x2e = {1.6, 1.8, 0.0, 3.0}</span>
                                        <span class="token comment">//          | 1.6  1.8 |</span>
                                        <span class="token comment">//          | 0.0  3.0 |</span>
<span class="token comment">//float2x2 m2x2f = float2x2(5.0); // 编译出错  error X3014: incorrect number of arguments to numeric-type constructor</span>
float2x2 m2x2g <span class="token operator">=</span> <span class="token punctuation">(</span>float2x2<span class="token punctuation">)</span><span class="token number">5.0</span><span class="token punctuation">;</span> <span class="token comment">// m2x2g = {5.0, 5.0, 5.0, 5.0}</span>
                                <span class="token comment">//          | 5.0  5.0 |</span>
                                <span class="token comment">//          | 5.0  5.0 |</span>

float2 f2b <span class="token operator">=</span> m2x2b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第1个行向量  f2b = {0.8  0.6}</span>
float2 f2c <span class="token operator">=</span> m2x2b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第2个行向量  f2c = {2.0  0.9}</span>

<span class="token keyword">float</span> f1 <span class="token operator">=</span> m2x2b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第1行第2列元素 f1 = 0.6</span>
<span class="token keyword">float</span> f2 <span class="token operator">=</span> m2x2b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第1行第2列元素 f2 = 0.6</span>
<span class="token keyword">float</span> f3 <span class="token operator">=</span> m2x2b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>g<span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第1行第2列元素 f3 = 0.6</span>
<span class="token keyword">float</span> f4 <span class="token operator">=</span> m2x2b<span class="token punctuation">.</span>_m01<span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第1行第2列元素 f4 = 0.6</span>
<span class="token keyword">float</span> f5 <span class="token operator">=</span> m2x2b<span class="token punctuation">.</span>_12<span class="token punctuation">;</span> <span class="token comment">// 获取m2x2b的第1行第2列元素 f5 = 0.6</span>
float2 f2d <span class="token operator">=</span> m2x2e<span class="token punctuation">.</span>_11_22 <span class="token comment">// 获取m2x2e的第1行第1列元素及第2行第2列元素 Swizzle f2d = {1.6  3.0}</span>
m2x2e<span class="token punctuation">.</span>_12_21 <span class="token operator">=</span> m2x2e<span class="token punctuation">.</span>_21_12<span class="token punctuation">;</span> <span class="token comment">// 交换m2x2e[0][1]和m2x2e[1][0] Swizzle</span>
                             <span class="token comment">// m2x2e = {1.6, 0.0, 1.8, 3.0}</span>
                             <span class="token comment">//          | 1.6  0.0 |</span>
                             <span class="token comment">//          | 1.8  3.0 |    </span>
m2x2e<span class="token punctuation">.</span>_m00_m11 <span class="token operator">=</span> m2x2e<span class="token punctuation">.</span>_m11_m00<span class="token punctuation">;</span>    <span class="token comment">// 交换M[0][0]和M[1][1]     Swizzle                         </span>
                             <span class="token comment">// m2x2e = {3.0, 0.0, 1.8, 1.6}</span>
                             <span class="token comment">//          | 3.0  0.0 |</span>
                             <span class="token comment">//          | 1.8  1.6 |</span>
                             
float2x2 m2x2h <span class="token operator">=</span> m2x2b <span class="token operator">+</span> m2x2c<span class="token punctuation">;</span> <span class="token comment">// m2x2h = {0.8, -0.4, 5.0, 1.0}</span>
float2x2 m2x2i <span class="token operator">=</span> m2x2b <span class="token operator">*</span> m2x2c<span class="token punctuation">;</span> <span class="token comment">// m2x2i = {0.0, -0.6, 6.0, 0.09}</span>
float2x2 m2x2j <span class="token operator">=</span> m2x2b <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">;</span> <span class="token comment">// m2x2j = {1.0, 0.8, 2.2, 1.1}</span>
float2x2 m2x2k <span class="token operator">=</span> m2x2b <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// m2x2k = {1.6, 1.2, 4.0, 1.8}</span>
<span class="token comment">//float2x2 m2x2l = f2a + m2x2b; // 编译错误  error X3020: type mismatch</span>
<span class="token comment">//float2x2 m2x2m = f2a * m2x2b; // 编译错误  error X3020: type mismatch</span>

float2x1 m2x1a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// m2x1a = { 1.0, 0.2 }</span>
                               <span class="token comment">//          | 1.0 |</span>
                               <span class="token comment">//          | 0.2 |</span>
float1x2 m1x2a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// m1x2a = { 0.3, 1.0 }    </span>
                               <span class="token comment">//         | 0.3  1.0 |</span>
<span class="token comment">// 矩阵算术运算  M x N --&gt; m x n   注：当M&gt;m且N&gt;n时，可裁剪降维后自动隐式转换</span>
float2x1 m2x1b <span class="token operator">=</span> f2a <span class="token operator">+</span> m2x1a<span class="token punctuation">;</span> <span class="token comment">// float2向量可与float2x1矩阵进行算术运算  </span>
                              <span class="token comment">// m1x2b = { 2.6, 2.0 }    </span>
                              <span class="token comment">//           | 2.6 |</span>
                              <span class="token comment">//           | 2.0 |</span>
float1x1 m1x1a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// | 0.2 |</span>
float3x3 m3x3a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
                   <span class="token comment">// | 0.1   0.0  0.2 |</span>
                   <span class="token comment">// | 0.15 -0.1  0.0 |</span>
                   <span class="token comment">// | -0.2  0.0  0.3 |</span>
<span class="token comment">//float2x2 m2x2n = m2x2b + m2x1a; // 编译错误  error X3017: cannot implicitly convert from 'const float2x1' to 'float2x2'</span>
float2x1 m2x1c <span class="token operator">=</span> m2x2b <span class="token operator">+</span> m2x1a<span class="token punctuation">;</span> <span class="token comment">// m1x2c = { 1.8, 0.8 } </span>
float2x2 m2x2o <span class="token operator">=</span> m2x2b <span class="token operator">+</span> m1x1a<span class="token punctuation">;</span> <span class="token comment">// m2x2o = {1.0, 0.8, 2.2, 1.1}  注：m1x1a退化为float</span>
float2x2 m2x2p <span class="token operator">=</span> m2x2b <span class="token operator">+</span> m3x3a<span class="token punctuation">;</span> <span class="token comment">// m2x2p = {0.9, 0.6, 2.15, 0.8}</span>
<span class="token comment">//float3x3 m3x3b = m3x3a + m2x2b; // 编译错误 error X3017 : cannot implicitly convert from 'const float2x2' to 'float3x3'</span>
<span class="token comment">//float3x3 m3x3c = m2x2b + m3x3a; // 编译错误 error X3017 : cannot implicitly convert from 'const float2x2' to 'float3x3'</span>


<span class="token comment">// 矩阵-矩阵乘法</span>
float1x1 m1x1b <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>m1x2a<span class="token punctuation">,</span> m2x1a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//                  | 1.0 |</span>
                                    <span class="token comment">// | 0.3  1.0 | mul | 0.2 | = 0.5</span>

float2x2 m2x2r <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>m2x1a<span class="token punctuation">,</span> m1x2a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  | 1.0 |                    | 0.3  1.0 |</span>
                                    <span class="token comment">// | 0.2 | mul | 0.3  1.0 | = | 0.06 0.2 |</span>

<span class="token comment">// 矩阵右乘向量</span>
float2x1 m2x1d <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>m2x2b<span class="token punctuation">,</span> f2a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// f2a被当成列向量</span>
                                   <span class="token comment">//  | 0.8  0.6 |     | 1.6 |   | 2.36 |</span>
                                    <span class="token comment">// | 2.0  0.9 | mul | 1.8 | = | 4.82 |</span>

<span class="token comment">// 矩阵左乘向量</span>
float1x2 m1x2b <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>f2a<span class="token punctuation">,</span> m2x2b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// f2a被当成行向量</span>
                                   <span class="token comment">//                   | 0.8  0.6 | </span>
                                   <span class="token comment">//  | 1.6  1.8 | mul | 2.0  0.9 | = | 4.88 2.58 |</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>纹理（texture）</strong></p>
<p>在glsl、CG或Effects Framework（效果框架）中引用纹理，只需要声明一个sampler2D。</p>
<p>而在HLSL中，sampler2D这个对象则被拆分为两部分：即Texture2D（纹理）和SamplerState（采样器），需要同时声明两个变量来保存它们。</p>
<p><strong>纹理</strong></p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Texture1D</td>
<td>1D纹理</td>
<td>RWTexture1D<float> tex;</float></td>
</tr>
<tr>
<td>Texture1DArray</td>
<td>1D纹理数组</td>
<td>RWTexture1DArray<float> tex;</float></td>
</tr>
<tr>
<td>Texture2D</td>
<td>2D纹理</td>
<td><code>Texture2D DiffuseTexture    : register( t0 ); Texture2D&lt;float&gt; DepthTexture         : register( t1 ); Texture2D&lt;float4&gt; ColorSpecIntTexture : register( t2 ); Texture2D&lt;float3&gt; NormalTexture       : register( t3 ); Texture2D&lt;float4&gt; SpecPowTexture      : register( t4 ); RWTexture2D&lt;float4&gt; MyTexture : register( u0 );</code></td>
</tr>
<tr>
<td>Texture2DArray</td>
<td>2D纹理数组</td>
<td>Texture2DArray<float> CascadeShadowMapTexture : register( t4 );RWTexture2DArray<float> tex;</float></float></td>
</tr>
<tr>
<td>Texture3D</td>
<td>3D纹理</td>
<td>RWTexture3D<float> tex;</float></td>
</tr>
<tr>
<td>Texture2DMS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Texture2DMSArray</td>
<td></td>
<td></td>
</tr>
<tr>
<td>TextureCube</td>
<td></td>
<td><code>TextureCube&lt;float&gt; PointShadowMapTexture : register( t4 );</code></td>
</tr>
<tr>
<td>TextureCubeArray</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>注1：只读纹理使用着色器资源视图（shader resource views，SRV）来绑定，用t寄存器来传递</p>
<p>注2：可读写纹理使用乱序访问视图（unordered access view，UAV）来绑定，用u寄存器来传递 UnorderedAccessView</p>
<p><strong>采样器</strong></p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>SamplerState</td>
<td>贴图采样器</td>
<td><code>SamplerState LinearSampler    : register( s0 );</code></td>
</tr>
<tr>
<td>SamplerComparisonState</td>
<td>阴影贴图采样器</td>
<td><code>///////////////////////////////////////////////////////////////////////////// // Shadow sampler ///////////////////////////////////////////////////////////////////////////// SamplerComparisonState PCFSampler : register( s2 );</code></td>
</tr>
</tbody></table>
<p>注：采样器（sampler）用s寄存器来传递</p>
<p><strong>示例</strong></p>
<p>在C++端是通过ID3D11DeviceContext::VSSetShaderResources、ID3D11DeviceContext::PSSetShaderResources指定特定的槽(slot)来给某一着色器阶段对应的寄存器索引提供纹理数据。</p>
<p>在C++端是通过ID3D11DeviceContext::VSSetSamplers、ID3D11DeviceContext::PSSetSamplers指定特定的槽(slot)来给某一着色器阶段对应的寄存器索引提供SamplerState数据。</p>
<p>当SamplerState不需要C++动态传入时，也可以在hlsl内部定义</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/****************************** C++ ******************************/</span>
ID3D11ShaderResourceView<span class="token operator">*</span>   g_pTexture1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
ID3D11ShaderResourceView<span class="token operator">*</span>   g_pTexture2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
ID3D11SamplerState<span class="token operator">*</span>         g_pSampLinear <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token comment">// PCF sampler state for shadow mapping</span>
ID3D11SamplerState<span class="token operator">*</span>         g_pPCFSamplerState <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token comment">// Create Shader Resouce View (Texture2D)</span>
WCHAR str<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">V_RETURN</span><span class="token punctuation">(</span> <span class="token function">DXUTFindDXSDKMediaFileCch</span><span class="token punctuation">(</span> str<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">,</span> L<span class="token string">"..\\Media\\Bokeh1.dds"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">V_RETURN</span><span class="token punctuation">(</span> <span class="token function">D3DX11CreateShaderResourceViewFromFile</span><span class="token punctuation">(</span> g_pDevice<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pTexture1<span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ID3D11Device* g_pDevice;</span>
<span class="token function">V_RETURN</span><span class="token punctuation">(</span> <span class="token function">DXUTFindDXSDKMediaFileCch</span><span class="token punctuation">(</span> str<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">,</span> L<span class="token string">"..\\Media\\Bokeh2.dds"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">V_RETURN</span><span class="token punctuation">(</span> <span class="token function">D3DX11CreateShaderResourceViewFromFile</span><span class="token punctuation">(</span> g_pDevice<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pTexture2<span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ID3D11Device* g_pDevice;</span>

<span class="token comment">// Set Shader Resources</span>
ID3D11ShaderResourceView<span class="token operator">*</span> arrViews<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> g_pTexture1<span class="token punctuation">,</span> g_pTexture2<span class="token punctuation">}</span><span class="token punctuation">;</span>
pd3dImmediateContext<span class="token operator">-&gt;</span><span class="token function">PSSetShaderResources</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> arrViews<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ID3D11DeviceContext* pd3dImmediateContext</span>

<span class="token comment">// --------------------------------------------------------------</span>

<span class="token comment">// Create sampler</span>
D3D11_SAMPLER_DESC samDesc<span class="token punctuation">;</span>
<span class="token function">ZeroMemory</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>samDesc<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>samDesc<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
samDesc<span class="token punctuation">.</span>Filter <span class="token operator">=</span> D3D11_FILTER_MIN_MAG_MIP_LINEAR<span class="token punctuation">;</span>
samDesc<span class="token punctuation">.</span>AddressU <span class="token operator">=</span> samDesc<span class="token punctuation">.</span>AddressV <span class="token operator">=</span> samDesc<span class="token punctuation">.</span>AddressW <span class="token operator">=</span> D3D11_TEXTURE_ADDRESS_WRAP<span class="token punctuation">;</span>
samDesc<span class="token punctuation">.</span>MaxAnisotropy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
samDesc<span class="token punctuation">.</span>ComparisonFunc <span class="token operator">=</span> D3D11_COMPARISON_ALWAYS<span class="token punctuation">;</span>
samDesc<span class="token punctuation">.</span>MaxLOD <span class="token operator">=</span> D3D11_FLOAT32_MAX<span class="token punctuation">;</span>
<span class="token function">V_RETURN</span><span class="token punctuation">(</span> pd3dDevice<span class="token operator">-&gt;</span><span class="token function">CreateSamplerState</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>samDesc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pSampLinear <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the PCF sampler state</span>
D3D11_SAMPLER_DESC samDesc2<span class="token punctuation">;</span>
<span class="token function">ZeroMemory</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>samDesc2<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>samDesc2<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
samDesc2<span class="token punctuation">.</span>Filter <span class="token operator">=</span> D3D11_FILTER_COMPARISON_MIN_MAG_MIP_LINEAR<span class="token punctuation">;</span>
samDesc2<span class="token punctuation">.</span>AddressU <span class="token operator">=</span> samDesc2<span class="token punctuation">.</span>AddressV <span class="token operator">=</span> samDesc2<span class="token punctuation">.</span>AddressW <span class="token operator">=</span> D3D11_TEXTURE_ADDRESS_CLAMP<span class="token punctuation">;</span>
samDesc2<span class="token punctuation">.</span>MaxAnisotropy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
samDesc2<span class="token punctuation">.</span>ComparisonFunc <span class="token operator">=</span> D3D11_COMPARISON_LESS_EQUAL<span class="token punctuation">;</span>
samDesc2<span class="token punctuation">.</span>MaxLOD <span class="token operator">=</span> D3D11_FLOAT32_MAX<span class="token punctuation">;</span>
<span class="token function">V_RETURN</span><span class="token punctuation">(</span> g_pDevice<span class="token operator">-&gt;</span><span class="token function">CreateSamplerState</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>samDesc2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pPCFSamplerState <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set render resources</span>
pd3dImmediateContext<span class="token operator">-&gt;</span><span class="token function">PSSetSamplers</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pSampLinear <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ID3D11DeviceContext* pd3dImmediateContext</span>

<span class="token comment">// Set the shadowmapping PCF sampler</span>
pd3dImmediateContext<span class="token operator">-&gt;</span><span class="token function">PSSetSamplers</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_pPCFSamplerState <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ID3D11DeviceContext* pd3dImmediateContext</span>


<span class="token comment">/***************************** HLSL *****************************/</span>

<span class="token comment">/////////////////////////////////////////////////////////////////////////////</span>
<span class="token comment">// Diffuse texture and linear sampler</span>
<span class="token comment">/////////////////////////////////////////////////////////////////////////////</span>
Texture2D    Diffuse1Texture <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> t0 <span class="token punctuation">)</span><span class="token punctuation">;</span>
Texture2D    Diffuse2Texture <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> t1 <span class="token punctuation">)</span><span class="token punctuation">;</span>
SamplerState LinearSampler <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> s0 <span class="token punctuation">)</span><span class="token punctuation">;</span>

SamplerComparisonState PCFSampler <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span> s2 <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// sampler define in shader code</span>
SamplerState MeshTextureSampler
<span class="token punctuation">{</span>
    Filter <span class="token operator">=</span> MIN_MAG_MIP_LINEAR<span class="token punctuation">;</span>
    AddressU <span class="token operator">=</span> Wrap<span class="token punctuation">;</span>
    AddressV <span class="token operator">=</span> Wrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

float4 <span class="token function">AmbientLightPS</span><span class="token punctuation">(</span> VS_OUTPUT In <span class="token punctuation">)</span> <span class="token operator">:</span> SV_TARGET0  <span class="token comment">// VS_OUTPUT In：VS的输出经过光栅化插值后，会作为输入传入PS</span>
<span class="token punctuation">{</span> 
    <span class="token comment">// Sample the texture and convert to linear space</span>
    float4 Diffuse1Color <span class="token operator">=</span>  Diffuse1Texture<span class="token punctuation">.</span><span class="token function">Sample</span><span class="token punctuation">(</span> LinearSampler<span class="token punctuation">,</span> In<span class="token punctuation">.</span>UV <span class="token punctuation">)</span><span class="token punctuation">;</span>
    float4 Diffuse2Color <span class="token operator">=</span>  Diffuse2Texture<span class="token punctuation">.</span><span class="token function">Sample</span><span class="token punctuation">(</span> LinearSampler<span class="token punctuation">,</span> In<span class="token punctuation">.</span>UV <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ... ...</span>

    <span class="token keyword">return</span> <span class="token function">float4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Diffuse1Color<span class="token operator">+</span>Diffuse2Color<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>函数</strong></p>
<p>函数用法和C语言一样</p>
<p>函数参数限定词说明：</p>
<table>
<thead>
<tr>
<th><strong>限定词</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>in</td>
<td>缺省限定词，可以省略不写</td>
</tr>
<tr>
<td>const</td>
<td>当前参数为常量，不可在函数内被修改</td>
</tr>
<tr>
<td>out</td>
<td>① 在函数内使用前必须先初始化② 在函数内修改后，对外可见</td>
</tr>
<tr>
<td>inout</td>
<td>① 接受函数外传入的初始值② 在函数内修改后，对外可见</td>
</tr>
</tbody></table>
<p>① 参数限定词只需要用在函数上，函数调用时不用带。</p>
<p>② 不允许函数递归  这一限制的原因是编译器会把函数都内联展开，以支持没有堆栈的GPU</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">float</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span> <span class="token comment">// 求平方</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">*</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">fuc1</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">float</span> value<span class="token punctuation">)</span> <span class="token comment">// const参数不能在函数内部修改</span>
<span class="token punctuation">{</span>
    <span class="token comment">//value = 0.2; // assignment to const variable value  编译错误</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">fuc2</span><span class="token punctuation">(</span>out <span class="token keyword">float</span> value<span class="token punctuation">)</span>  <span class="token comment">// value在函数内使用前必须先初始化；在函数内修改，对外可见</span>
<span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">// 注：在函数内使用out参数之前，必须先初始化，否则会编译错误</span>
    value <span class="token operator">+=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">fuc3</span><span class="token punctuation">(</span>inout <span class="token keyword">float</span> value<span class="token punctuation">)</span> <span class="token comment">// value的初始值从函数外传入；在函数内修改，对外可见</span>
<span class="token punctuation">{</span>
    value <span class="token operator">+=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">fun4</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>  <span class="token comment">// 直接或间接调用fun4函数，会编译报错：recursive call to function</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">fun4</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fun4</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>内置函数（Intrinsic Functions）</strong></p>
<p>HLSL提供了一些<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-intrinsic-functions">内置全局函数</a>，它通常直接映射到指定的着色器汇编指令集。这里只列出一些比较常用的函数：</p>
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>说明</strong></th>
<th><strong>最小支持的着色器版本</strong></th>
</tr>
</thead>
<tbody><tr>
<td>abs(x)</td>
<td>求x的绝对值　注：x为向量或矩阵时，表示求各分量的abs</td>
<td>1.1</td>
</tr>
<tr>
<td>acos(x)</td>
<td>求x的反余弦值</td>
<td>1.1</td>
</tr>
<tr>
<td>ceil(x)</td>
<td>返回不小于x的最小整数</td>
<td>1.1</td>
</tr>
<tr>
<td>clamp(x, a, b)</td>
<td>把x夹钳在[a, b]内</td>
<td>1.1</td>
</tr>
<tr>
<td>cos(x)</td>
<td>计算x的余弦值。x的单位为弧度</td>
<td>1.1</td>
</tr>
<tr>
<td>cross(u,v)</td>
<td>计算u、v向量的叉乘（外积）</td>
<td>1.1</td>
</tr>
<tr>
<td>degrees(x)</td>
<td>将x从弧度转成角度</td>
<td>1.1</td>
</tr>
<tr>
<td>determinant(M)</td>
<td>返回矩阵的行列式det(M)</td>
<td>1.1</td>
</tr>
<tr>
<td>distance(u, v)</td>
<td>返回两点u和v之间的距离 || u - v ||</td>
<td>1.1</td>
</tr>
<tr>
<td>dot(u, v)</td>
<td>返回向量u和v的点乘（内积）</td>
<td>1.1</td>
</tr>
<tr>
<td>dst(u, v)</td>
<td>计算距离向量</td>
<td>5.0</td>
</tr>
<tr>
<td>floor(x)</td>
<td>返回不大于x的最大整数</td>
<td>1.1</td>
</tr>
<tr>
<td>length(v)</td>
<td>返回向量v的模 || v ||</td>
<td>1.1</td>
</tr>
<tr>
<td>lerp(u, v, t)</td>
<td>在u和v之间做线性插值，并返回t所在比例的值 注：t在[0,1]之间</td>
<td>1.1</td>
</tr>
<tr>
<td>log(x)</td>
<td>返回ln(x) 注：以e为底数的对数值</td>
<td>1.1</td>
</tr>
<tr>
<td>log10(x)</td>
<td>返回以10为底数的对数值</td>
<td>1.1</td>
</tr>
<tr>
<td>log2(x)</td>
<td>返回以2为底数的对数值</td>
<td>1.1</td>
</tr>
<tr>
<td>max(x, y)</td>
<td>返回x，y中的较大的一个</td>
<td>1.1</td>
</tr>
<tr>
<td>min(x, y)</td>
<td>返回x，y中的较小的一个</td>
<td>1.1</td>
</tr>
<tr>
<td>mul(M, N)</td>
<td>矩阵乘法若M为向量，被视为行向量；若N为向量，被视为列向量</td>
<td>1.1</td>
</tr>
<tr>
<td>normalize(v)</td>
<td>对向量v归一化，返回v / || v ||</td>
<td>1.1</td>
</tr>
<tr>
<td>pow(b, n)</td>
<td>返回b的n次幂</td>
<td>1.1</td>
</tr>
<tr>
<td>radians(x)</td>
<td>将x从角度转为弧度</td>
<td>1</td>
</tr>
<tr>
<td>reflect(v, n)</td>
<td>给定入射向量v和表面法线n时，求出反射向量</td>
<td>1</td>
</tr>
<tr>
<td>refract(v, n, eta)</td>
<td>给定折射向量v、表面法线n及两种材质的折射度索引的比率eta，求出折射向量详见：斯涅耳定律（Snell’s Law）</td>
<td>1.1</td>
</tr>
<tr>
<td>rsqrt(x)</td>
<td>返回1/sqrt(x)</td>
<td>1.1</td>
</tr>
<tr>
<td>saturate(x)</td>
<td>返回clamp(x, 0.0, 1.0)</td>
<td>1</td>
</tr>
<tr>
<td>sin(x)</td>
<td>计算x的正弦值。x的单位为弧度</td>
<td>1.1</td>
</tr>
<tr>
<td>sincos(in x, out s, out c)</td>
<td>计算x的正弦值s和余弦值c。x的单位为弧度</td>
<td>1.1</td>
</tr>
<tr>
<td>sqrt(x)</td>
<td>对x开根号</td>
<td>1.1</td>
</tr>
<tr>
<td>tan(x)</td>
<td>返回x的正切值。x的单位为弧度</td>
<td>1.1</td>
</tr>
<tr>
<td>transpose(M)</td>
<td>返回矩阵M的转置矩阵</td>
<td>1</td>
</tr>
</tbody></table>
<p>引用：<a target="_blank" rel="noopener" href="https://www.icode9.com/content-4-1054045.html">https://www.icode9.com/content-4-1054045.html</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/BloodSoul.github.io/about" rel="external nofollow noreferrer">血魂S</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://klj35.github.io/BloodSoul.github.io/2021/12/21/gamedevelop/gamecontent/rendering/li-lun-zhi-shi/tu-xing-ying-jian/gpu-jia-gou/shaderlanguage/shaderlanguage/">https://klj35.github.io/BloodSoul.github.io/2021/12/21/gamedevelop/gamecontent/rendering/li-lun-zhi-shi/tu-xing-ying-jian/gpu-jia-gou/shaderlanguage/shaderlanguage/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/BloodSoul.github.io/about" target="_blank">血魂S</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/BloodSoul.github.io/tags/%E5%9B%BE%E5%BD%A2%E7%A1%AC%E4%BB%B6/">
                                    <span class="chip bg-color">图形硬件</span>
                                </a>
                            
                                <a href="/BloodSoul.github.io/tags/GPU%E6%9E%B6%E6%9E%84/">
                                    <span class="chip bg-color">GPU架构</span>
                                </a>
                            
                                <a href="/BloodSoul.github.io/tags/ShaderLanguage/">
                                    <span class="chip bg-color">ShaderLanguage</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/BloodSoul.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/BloodSoul.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/BloodSoul.github.io/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/BloodSoul.github.io/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/BloodSoul.github.io/2021/12/21/gamedevelop/gamecontent/rendering/li-lun-zhi-shi/tu-xing-ying-jian/gpu-jia-gou/tu-xing-api/tu-xing-api/">
                    <div class="card-image">
                        
                        
                        <img src="/BloodSoul.github.io/medias/featureimages/20.jpg" class="responsive-img" alt="图形API">
                        
                        <span class="card-title">图形API</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            各个平台图形API记录
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-12-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/BloodSoul.github.io/categories/Rendering/" class="post-category">
                                    Rendering
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/BloodSoul.github.io/tags/%E5%9B%BE%E5%BD%A2%E7%A1%AC%E4%BB%B6/">
                        <span class="chip bg-color">图形硬件</span>
                    </a>
                    
                    <a href="/BloodSoul.github.io/tags/GPU%E6%9E%B6%E6%9E%84/">
                        <span class="chip bg-color">GPU架构</span>
                    </a>
                    
                    <a href="/BloodSoul.github.io/tags/%E5%9B%BE%E5%BD%A2API/">
                        <span class="chip bg-color">图形API</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/BloodSoul.github.io/2021/11/12/gamedevelop/gamecontent/rendering/xuan-ran-xiao-guo/hou-chu-li/color-lut-zhi-zuo/">
                    <div class="card-image">
                        
                        
                        <img src="/BloodSoul.github.io/medias/featureimages/25.jpg" class="responsive-img" alt="Color_LUT制作">
                        
                        <span class="card-title">Color_LUT制作</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            颜色查找表的制作方法
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-11-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/BloodSoul.github.io/categories/Rendering/" class="post-category">
                                    Rendering
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/BloodSoul.github.io/tags/%E6%B8%B2%E6%9F%93%E6%95%88%E6%9E%9C/">
                        <span class="chip bg-color">渲染效果</span>
                    </a>
                    
                    <a href="/BloodSoul.github.io/tags/%E5%90%8E%E5%A4%84%E7%90%86/">
                        <span class="chip bg-color">后处理</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('60')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 血魂S<br />'
            + '文章作者: 血魂S<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/BloodSoul.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/BloodSoul.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/BloodSoul.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/BloodSoul.github.io/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/BloodSoul.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2023</span>
            
            <span id="year">2021</span>
            <a href="/BloodSoul.github.io/about" target="_blank">血魂S</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">80k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/klj35" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>









    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2605938581" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2605938581" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/BloodSoul.github.io/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/BloodSoul.github.io/libs/materialize/materialize.min.js"></script>
    <script src="/BloodSoul.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/BloodSoul.github.io/libs/aos/aos.js"></script>
    <script src="/BloodSoul.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/BloodSoul.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/BloodSoul.github.io/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/BloodSoul.github.io/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/BloodSoul.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/BloodSoul.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
